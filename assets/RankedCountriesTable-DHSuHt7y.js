import{z as e,u as s,A as t,B as a,k as l,C as r,D as n,P as c,E as o,i,n as d,F as m,G as h,H as x,t as u,j as g,e as p,q as f,I as j,x as y,l as w}from"./index-B8I1wJbW.js";import{r as b}from"./react-VFLnq-og.js";import{k as C,u as N,b as v,A as S,B as k,D as P,E as z,G as _,c as T,T as D,H as E,I as L,J as I,K as R,S as U}from"./App-BTM1T34o.js";import{R as A}from"./index-B0rdmaSg.js";import{D as G}from"./Dropdown-BBqchyRE.js";import{M as $}from"./Modal-DQr5zMsM.js";import"./redux-QBcbxzSO.js";const M=({handleSort:e,sortColumn:s,sortDirection:t,showSelected:a})=>{const l=({column:e})=>("country"===e&&(e="to_country"),s!==e?null:"asc"===t?g.jsx(v,{icon:S,className:"ml-2"}):g.jsx(v,{icon:k,className:"ml-2"}));return g.jsx("thead",{className:"bg-slate-700 text-slate-300 sticky top-0 z-40",children:g.jsxs("tr",{children:[g.jsx("th",{className:"py-3 text-center text-xs font-medium uppercase tracking-wider sticky left-0 z-50 bg-slate-700",children:a?"Del":"Add"}),["Year","Country","Performer","Song"].map((s=>g.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider cursor-pointer hover:bg-[#3068ba]",onClick:()=>e(s.toLowerCase()),children:g.jsxs("div",{className:"flex items-center whitespace-nowrap",children:[s,g.jsx(l,{column:s.toLowerCase()})]})},s)))]})})},O=({paginatedContestants:e,handleToggleSelected:s,showSelected:t,selectedContestants:a})=>g.jsx("tbody",{className:"bg-transparent divide-y divide-gray-700",children:e.map((e=>g.jsxs("tr",{className:"hover:bg-slate-800 bg-opacity-50 text-slate-300",children:[g.jsx("td",{className:"py-0 whitespace-nowrap sticky left-0 z-30 bg-slate-900 hover:bg-[#3068ba]",children:g.jsx("div",{className:"flex justify-center h-full",children:g.jsx(A,{className:"flex items-center justify-center w-full h-full",placeholder:g.jsx(g.Fragment,{}),children:g.jsx("button",{onClick:()=>s(e.id),className:"text-slate-300 hover:text-slate-100 p-2 rounded-md h-full w-full",children:t?g.jsx(v,{icon:P,className:"text-red-500"}):a.some((s=>s.id===e.id))?g.jsx(v,{icon:z,className:"text-green-500"}):g.jsx(v,{icon:_})})})})}),g.jsx("td",{className:"px-6 py-4 whitespace-nowrap overflow-x-clip",children:e.year}),g.jsx("td",{className:"px-6 py-4 whitespace-nowrap overflow-x-clip",children:e.to_country}),g.jsx("td",{className:"px-6 py-4 whitespace-nowrap overflow-x-clip",title:e.performer,children:e.performer}),g.jsx("td",{className:"px-6 py-4 whitespace-nowrap overflow-x-clip",title:e.song,children:e.song})]},e.id)))}),B=({searchTerm:e,handleSearch:s,className:t})=>g.jsxs("div",{className:T("w-full sm:w-auto flex-grow sm:flex-grow-0 flex items-center",t),children:[g.jsx(D,{content:'Search across all columns. To search for a phrase, enclose your search term in quotes "like this"',className:"mt-2 mr-3 pb-1"}),g.jsxs("div",{className:"relative w-full mr-3",children:[g.jsx("input",{type:"text",value:e,onChange:s,placeholder:"Search...",className:"text-sm w-full pl-10 pr-4 py-[0.4em] border rounded-md focus:outline-none focus:ring-2 focus:ring-slate-400 bg-transparent text-slate-300 border-slate-400"}),g.jsx(v,{icon:E,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400"})]})]}),F=({pageSize:e,currentPage:s,totalPages:t,displayedContestants:a,handlePageSizeChange:l,handlePageChange:r})=>g.jsxs("div",{className:"mt-1 flex justify-between px-2",children:[g.jsxs("div",{children:[g.jsx(G,{value:`${e}`,onChange:l,options:["10","25","50"],buttonClassName:"",className:"min-w-[0.9em] text-xs mt-2",openUpwards:!0,mini:!0}),g.jsxs("span",{className:T("text-sm text-gray-300 ml-2 mr-3 whitespace-nowrap","text-xs mr-1"),children:["of ",a.length]})]}),g.jsx("div",{className:"space-x-1 space-y-2",children:g.jsxs(g.Fragment,{children:[g.jsx("button",{onClick:()=>r(1),disabled:1===s,className:"text-sm px-2 py-1 rounded bg-gray-700 text-gray-300 hover:bg-gray-600 disabled:opacity-50",children:"<<"}),g.jsx("button",{onClick:()=>r(s-1),disabled:1===s,className:"text-sm px-2 py-1 rounded bg-gray-700 text-gray-300 hover:bg-gray-600 disabled:opacity-50",children:"<"}),g.jsxs("span",{className:"text-sm text-gray-300",children:[s," / ",t]}),g.jsx("button",{onClick:()=>r(s+1),disabled:s===t,className:"text-sm px-2 py-1 rounded bg-gray-700 text-gray-300 hover:bg-gray-600 disabled:opacity-50",children:">"}),g.jsx("button",{onClick:()=>r(t),disabled:s===t,className:"text-sm px-2 py-1 rounded bg-gray-700 text-gray-300 hover:bg-gray-600 disabled:opacity-50",children:">>"})]})})]}),H=({isOpen:e,onClose:s,onConfirm:t,message:a})=>g.jsxs($,{isOpen:e,onClose:s,className:"max-w-[28em]",closeBtnClassName:"hidden",children:[g.jsx("div",{className:"mb-4 text-sm text-gray-900 dark:text-slate-300 whitespace-pre-line leading-[1.2em]",children:a}),g.jsxs("div",{className:"float-right mt-1 -mb-1",children:[g.jsx(L,{className:"",onClick:()=>{t(),s()},title:"Confirm"}),g.jsx(L,{className:"ml-2",onClick:s,title:"Cancel",isGrayTheme:!0})]})]}),q=()=>{const v=C(),S=N((e=>e.showUnranked)),k=N((e=>e.rankedItems)),P=N((e=>e.tableState)),{sortColumn:z,sortDirection:_}=P,[E,A]=b.useState(!1),G=N((e=>e.activeCategory)),$=I(),{refreshUrl:q}=R(),Y=(()=>{const e=N((e=>e.rankedItems)),s=N((e=>e.globalSearch)),a=N((e=>e.categories));return b.useCallback((l=>{let r=s;void 0!==l&&(r=l),t(a,r,e)}),[s,e])})(),{paginatedContestants:J,handleSort:K,handleSearch:V,handlePageSizeChange:W,handlePageChange:Q,handleToggleSelected:X,searchTerm:Z,showSelected:ee,setShowSelected:se,globalSearch:te,updateGlobalSearch:ae,pageSize:le,currentPage:re,totalPages:ne,displayedContestants:ce,selectedContestants:oe}=(()=>{const g=C(),p=N((e=>e.tableState)),f=N((e=>e.rankedItems)),j=N((e=>e.globalSearch)),y=N((e=>e.categories)),w=N((e=>e.activeCategory)),{sortColumn:v,sortDirection:S,pageSize:k,currentPage:P,entries:z,selectedContestants:_}=p,[T,D]=b.useState(""),[E,L]=b.useState(!1),I=b.useRef([]),R=b.useRef([]);b.useEffect((()=>{j&&(async()=>{try{let e=z;if(!(null==z?void 0:z.length)){const s=await fetch("/contestants.csv"),t=await s.text();e=G(t),g(n(e))}if(f.length>0){const s=new Set(f.map((e=>e.uid))),t=e.filter((e=>s.has(e.id)));$(t,_)||g(l(t))}A()}catch(e){}})()}),[j,z.length,f,g]);const U=b.useCallback((()=>{f.map((e=>e.uid)).join("");const t={};y.forEach(((s,a)=>{const l=`r${a+1}`,r=e(l)||"";t[l]=r})),s(t)}),[f,y]),A=b.useCallback((()=>{t(y,j,f)}),[j,f,y]),G=e=>c.parse(e,{header:!0,skipEmptyLines:!0,transformHeader:e=>e.trim(),transform:e=>e.trim()}).data.map((e=>({id:e.id,year:parseInt(e.year,10),to_country_id:e.to_country_id,to_country:e.to_country,performer:e.performer,song:e.song,place_contest:parseInt(e.place_contest,10)}))).filter((e=>e.year&&e.to_country&&e.performer&&e.song)),$=(e,s)=>{if(e.length!==s.length)return!1;for(let t=0;t<e.length;t++)if(e[t].id!==s[t].id||e[t].year!==s[t].year)return!1;return!0};b.useEffect((()=>{(async()=>{if($(I.current,_))return;const s=e("v")??"";try{const e=f||[],t=new Set(e.map((e=>e.uid))),a=new Set(_.map((e=>e.id))),l=_.filter((e=>!t.has(e.id))).map((e=>e.id)),r=e.filter((e=>!a.has(e.uid))).map((e=>e.uid)),n=await o(l,s),c=[...e.filter((e=>!r.includes(e.uid))),...n];((e,s)=>{if(e.length!==s.length)return!1;for(let t=0;t<e.length;t++)if(e[t].uid!==s[t].uid)return!1;return!0})(c,R.current)||(g(i(c)),d(w,y,c),R.current=c),I.current=_}catch(t){}})()}),[_,w,y,f,g]),b.useEffect((()=>{g(a(1)),D("")}),[E,g]);const M=b.useMemo((()=>{const e=E?_:z,s=new Set;let t=e.filter((e=>!s.has(e.id)&&(s.add(e.id),!0)));if(T){const e=/^".*"$/.test(T.trim())?[T.trim().slice(1,-1).toLowerCase()]:T.toLowerCase().split(/\s+/);t=t.filter((s=>e.every((e=>Object.entries(s).some((([s,t])=>"id"!==s&&String(t).toLowerCase().includes(e)))))))}return v&&t.sort(((e,s)=>e[v]<s[v]?"asc"===S?-1:1:e[v]>s[v]?"asc"===S?1:-1:0)),t}),[z,_,E,T,v,S]),O=Math.ceil(M.length/k),B=M.slice((P-1)*k,P*k),F=b.useCallback(((e,t)=>{y.forEach(((a,l)=>{const r=`r${l+1}`;let n,c=new URLSearchParams(window.location.search).get(r)||"";c.startsWith(">")||(c=`>${c}`),n=t?c+e:c.replace(e,""),s({[r]:n})}))}),[y]),H=b.useCallback((e=>{let s;if(_.some((s=>s.id===e)))s=_.filter((s=>s.id!==e)),F(e,!1);else{const t=p.entries.find((s=>s.id===e));if(!t)return;s=[..._,t],F(e,!0)}g(l(s)),j&&U()}),[_,p.entries,g,F,j,U,A]);return b.useEffect((()=>{$(p.paginatedContestants,B)||g(r(B))}),[p.currentPage,p.filters,p.entries,p.sortDirection,p.sortColumn,p.pageSize]),{paginatedContestants:B,handleSort:e=>{"country"===e&&(e="to_country"),g(m(e))},handleSearch:e=>{D(e.target.value),g(h({search:e.target.value}))},handlePageSizeChange:e=>{g(x(Number(e)))},handlePageChange:e=>{g(a(e))},handleToggleSelected:H,searchTerm:T,showSelected:E,setShowSelected:L,globalSearch:j,updateGlobalSearch:e=>{s({g:e?"t":void 0}),g(u(e)),A()},pageSize:k,currentPage:P,totalPages:O,displayedContestants:M,selectedContestants:_,convertRankingURLParams:A}})(),ie=()=>{ae(!1),Y(!1)};return g.jsxs("div",{className:"flex flex-col h-full bg-transparent text-slate-300",children:[g.jsxs("div",{className:T("flex flex-col mb-1 pr-1 sm:flex-row sm:items-center sm:space-x-4"),children:[g.jsx("div",{className:T("w-full xs:w-1/2"),children:g.jsx(B,{searchTerm:Z,handleSearch:V,className:"w-full mb-1"})}),g.jsxs("div",{className:T("flex items-center justify-between pb-1 text-sm mt-1 sm:mt-0 sm:justify-end sm:flex-grow min-w-[50%]"),children:[g.jsx(U,{label:"selected",className:"text-base",labelClassName:"text-slate-400",checked:ee,setChecked:se}),g.jsxs("div",{className:"flex items-center gap-1 mr-3",children:[g.jsxs("div",{className:"flex items-center",children:[g.jsx(D,{content:"Uncheck this to use the simple year-based selection mode",className:"text-slate-300 align-middle mb-0 -mr-1"}),g.jsx(U,{label:"adv",className:"items-center align-middle",labelClassName:"text-base text-slate-400",checked:te,setChecked:async e=>{if(e)ae(e);else if(f(G)){const e=j(k);1===(null==e?void 0:e.length)?(v(y(e[0])),ie(),q(),await w(G,v)):A(!0)}else $(),ie()}})]}),g.jsx(L,{className:T("tada-animation pl-[0.7em] pr-[0.9em] w-[6em]",{"tada-animation":S&&(null==k?void 0:k.length)}),onClick:()=>v(p(!S)),title:"View List"})]})]})]}),g.jsx(H,{isOpen:E,onClose:()=>A(!1),onConfirm:()=>{$(),ie()},message:"Are you sure you want to turn off advanced global search mode? \n\nYour current selections will be cleared, since they contain contestants from multiple years."}),g.jsx("div",{className:"flex-grow overflow-auto !rounded-t-md !rounded-tr-md mr-1 shadow-xl",children:g.jsx("div",{className:"relative",children:g.jsxs("table",{className:"w-full bg-transparent table-fixed",children:[g.jsxs("colgroup",{children:[g.jsx("col",{className:"w-[3em]"}),g.jsx("col",{className:"w-24"}),g.jsx("col",{className:"w-40"}),g.jsx("col",{className:"w-48"}),g.jsx("col",{className:"w-64"})]}),g.jsx(M,{handleSort:K,sortColumn:z,sortDirection:_,showSelected:!1}),g.jsx(O,{paginatedContestants:J,handleToggleSelected:X,showSelected:ee,selectedContestants:oe})]})})}),g.jsx(F,{pageSize:le,currentPage:re,totalPages:ne,displayedContestants:ce,handlePageSizeChange:W,handlePageChange:Q})]})},Y=()=>{const[e,s]=b.useState(0),t=N((e=>e.rankedItems)),a=N((e=>e.categories)),l=N((e=>e.activeCategory));return b.useEffect((()=>{0!==e&&d(l,a,t)}),[e]),g.jsx("div",{className:"z-20",children:g.jsx("div",{className:T("grid h-full max-h-full min-h-full grid-rows-[auto_1fr]"),children:g.jsx("div",{className:"overflow-y-auto h-full",children:g.jsx(q,{})})})})};export{Y as default};
