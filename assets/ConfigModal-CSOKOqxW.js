import{j as e,u as a,K as s,L as t,y as l,f as n,M as r,N as o,O as i,Q as c,R as m,S as d,v as h,T as x,U as p,V as u,W as v,i as g,X as j,Y as b,Z as y,$ as f,a0 as N,a1 as w,z as k}from"./index-BK6C65fn.js";import{r as C,R as S}from"./react-VFLnq-og.js";import{u as $,I as A,s as M,R as E,c as T,k as z,U as F,V as R,T as O,W,X as D,Y as I,Z as U,q as B,r as L,$ as V,p as J,a0 as X}from"./App-Ck3OA2k7.js";import{M as K}from"./Modal-BM1aylsK.js";import{D as Y}from"./Dropdown-CJx971Vt.js";import{E as Z,c as q,a as Q,g as _,b as G,d as H}from"./ExportUtil-RJKvS3YT.js";import{T as P}from"./TabButton-BezShb10.js";import"./redux-QBcbxzSO.js";const ee=()=>{const[a,s]=C.useState("Text"),t=Object.values(Z).map((e=>e)),l=$((e=>e.rankedItems));return e.jsxs("div",{className:"mb-0",children:[e.jsx("div",{className:"mb-[1.5em]",children:e.jsx(A,{className:"pl-[0.7em] ml-0 py-[0.5em] px-[1em]",onClick:q,icon:M,title:"Copy URL to Clipboard"})}),e.jsx(Y,{className:"z-50 w-20 h-10 mx-auto",menuClassName:"",value:a,onChange:e=>s(e),options:t,showSearch:!1},"type-selector"),e.jsxs("div",{children:[e.jsx(A,{className:"ml-0 pl-[0.7em] rounded-md text-xs py-[0.5em] pr-[1em]",onClick:async function(){let e=await _(a,l),s=G(a);H(e,null==s?void 0:s.fileExtension)},icon:E,title:"Download"}),e.jsx(A,{className:"ml-4 pl-[0.7em] py-[0.5em] pr-[1em]",onClick:()=>Q(l,a),icon:M,title:"Copy to Clipboard"})]})]})},ae=({checked:a,onChange:s,label:t,className:l,id:n})=>e.jsxs("div",{className:T("inline-flex items-center",l),children:[e.jsxs("label",{className:"relative flex items-center p-3 rounded-full cursor-pointer",htmlFor:"blue",children:[e.jsx("input",{type:"checkbox",className:"before:content[''] peer relative h-5 w-5 cursor-pointer appearance-none rounded-md border border-blue-gray-200 transition-all before:absolute before:top-2/4 before:left-2/4 before:block before:h-12 before:w-12 before:-translate-y-2/4 before:-translate-x-2/4 before:rounded-full before:bg-blue-gray-500 before:opacity-0 before:transition-opacity checked:border-blue-500 checked:bg-blue-500 checked:before:bg-blue-500 hover:before:opacity-10",id:n,checked:a??!1,onChange:e=>s(e.target.checked)},`key-${n}`),e.jsx("span",{className:"absolute text-white transition-opacity opacity-0 pointer-events-none top-2/4 left-2/4 -translate-y-2/4 -translate-x-2/4 peer-checked:opacity-100",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",viewBox:"0 0 20 20",fill:"currentColor",stroke:"currentColor",strokeWidth:"1",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]}),e.jsx("span",{className:"text-slate-400 text-sm",children:t})]}),se=()=>{const t=z(),l=$((e=>e.categories)),n=$((e=>e.activeCategory)),[r,o]=C.useState(""),i=$((e=>e.showComparison)),c=()=>{if(""!==r.trim()){if(!D(r,l))return;const e=[...l,{name:r,weight:5}];o(""),F(e,t,l,n)}};return e.jsxs("div",{className:"mb-0",children:[e.jsxs("p",{className:"relative mb-[1em] mt-2 text-sm",children:["Create categories to build multiple rankings based on different criteria: e.g. ",e.jsx("i",{children:"Vocals, Dance, Lyrics"})," ","etc."]}),e.jsxs("div",{className:"mt-5 mb-[1.5em]",children:[e.jsx("span",{className:"font-bold ml-0 whitespace-nowrap",children:"Categories"}),e.jsxs("div",{className:"mt-4",children:[e.jsx("input",{type:"text",placeholder:"Enter category name",value:r,onChange:e=>o(e.target.value),onKeyDown:e=>{"Enter"===e.key&&c()},className:"px-2.5 py-1.5 ml-1 mr-3 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white"}),e.jsx(A,{className:"ml-1 pl-[0.7em] py-[0.5em] pr-[1em]",onClick:c,icon:void 0,title:"Add"}),(null==l?void 0:l.length)>0&&e.jsx(A,{className:"ml-3 mt-2 bg-rose-800 hover:bg-rose-700 text-white font-normal pl-[0.7em] py-[0.5em] pr-[1em]",onClick:()=>{F([],t,l,n)},disabled:!(null==l?void 0:l.length),icon:R,title:"Clear"})]}),e.jsxs("div",{className:"mt-1",children:[e.jsx(O,{content:"When viewing a category ranking, also display the contestant's rank in each other category",className:"ml-2 pb-1"}),e.jsx(ae,{id:"total-checkbox",checked:i,onChange:e=>{return a({cm:!0===(l=e)?"t":"f"}),void t(s(!0===l));var l},label:"Show Category Comparisons"})]}),e.jsxs("table",{className:"mt-4 w-full table-auto",children:[(null==l?void 0:l.length)>0&&e.jsx("thead",{children:e.jsxs("tr",{className:"text-sm",children:[e.jsx("th",{className:"text-left px-2",children:"Name"}),e.jsx("th",{className:"text-left px-2",children:"Weight"}),e.jsx("th",{className:"px-2"})]})}),e.jsx("tbody",{children:l.map(((a,s)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 py-2",children:e.jsx("input",{type:"text",value:a.name,onChange:e=>((e,a)=>{if(!D(a,l))return;let s=[...l];s[e]={...l[e],name:a},F(s,t,l,n)})(s,e.target.value),className:"px-2.5 py-1.5 mr-3 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white w-full"})}),e.jsx("td",{className:"px-2",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"range",min:"0",max:"10",step:"1",value:a.weight,onChange:e=>((e,a)=>{let s=[...l];s[e]={...s[e],weight:a},F(s,t,l,n)})(s,parseInt(e.target.value)),className:"w-full"}),e.jsx("span",{className:"ml-2 w-3",children:a.weight})]})}),e.jsx("td",{className:"px-2",children:e.jsx("button",{onClick:()=>W(s,t,l,n),className:"bg-rose-700 hover:bg-rose-600 text-white rounded-md px-2 py-[0.1em]",children:"X"})})]},s)))})]})]})]})},te=()=>{z();const a=$((e=>e.year)),s=$((e=>e.theme)),[h,x]=C.useState(a),[p,u]=C.useState("All"),[v,g]=C.useState(["All",...t.sort(((e,a)=>e.name.localeCompare(a.name))).map((e=>e.name))]),[j,b]=C.useState(!1),[y,f]=C.useState(!1);C.useEffect((()=>{(async()=>{const e=await n(h,void 0);g(["All",...e.map((e=>e.country)).sort(((e,a)=>e.name.localeCompare(a.name))).map((e=>e.name))]),f(r(e)),b(o(e))})()}),[h]);const N=async(e,s,l,r)=>{var o;let i,c;(null==r?void 0:r.length)&&"All"!==r&&(c=null==(o=t.find((e=>e.name===r)))?void 0:o.key,c&&(i=`${l}-${s}-${c}`));let h=await n(e,i);if("1956"===m(a))return h.filter((e=>{var a;return"1"===(null==(a=e.contestant)?void 0:a.finalsRank.toString())})).map((e=>e.id)).join("");h=await d(h,s,l,c);return h.filter((e=>{var a;return void 0!==(null==(a=null==e?void 0:e.contestant)?void 0:a.votes)})).map((e=>e.id)).join("")},w=async e=>{const s=h??a;return`?r=${await N(s,"televote","final",e)}&y=${s.substring(2,4)}&n=Final+Televote${S(e)}&v=${c("f","tv",e)}`},k=async e=>{const s=h??a;return`?r=${await N(s,"jury","final",e)}&y=${s.substring(2,4)}&n=Final+Jury${S(e)}&v=${c("f","j",e)}`},S=e=>(null==e?void 0:e.length)&&"All"!==e?`+from+${e.replaceAll(" ","+")}`:"";return e.jsxs("div",{className:"mb-0",children:[e.jsx("p",{className:"relative mb-[1em] mt-2 text-sm",children:"Select a year and voting country, then click one of the buttons to see official final rankings"}),e.jsxs("div",{className:"mt-5",children:[e.jsx("span",{className:"font-bold ml-0 whitespace-nowrap",children:"ESC final rankings"}),e.jsxs("div",{className:" mt-[0.7em]",children:[e.jsxs("div",{children:[e.jsx(Y,{className:"w-20 mx-auto mb-2",menuClassName:"",value:h??a,onChange:e=>x(e),options:l.filter((e=>"2020"!==e)),showSearch:!0}),e.jsx("span",{className:"ml-2 text-sm",children:"from"}),e.jsx(O,{content:"Choose which country to display voting counts from. 'All' will show the total vote count",className:"ml-4 z-50"}),e.jsx(Y,{className:"ml-3 mx-auto mb-2",menuClassName:"w-auto",value:p,onChange:e=>u(e),options:v,showSearch:!0},"country-selector")]}),e.jsx("div",{className:"mt-2 ml-0",children:e.jsxs("span",{className:"",children:[e.jsx(A,{onClick:async()=>{const e=h??a,t=await N(e,"total","final",p);i(`?r=${t}&y=${e.substring(2,4)}&n=Final${S(p)}&v=${c("f","t",p)}`,s)},className:"pl-[1em] pr-[1em] rounded-md",title:"total"}),y&&e.jsx(A,{onClick:async()=>{const e=await w(p);i(e,s)},className:"ml-3 pl-[1em] pr-[1em] rounded-md",title:"televote"}),j&&e.jsx(A,{onClick:async()=>{const e=await k(p);i(e,s)},className:"ml-3 pl-[1em] pr-[1em] rounded-md",title:"jury"})]})})]})]})]})},le=()=>{const l=z(),n=$((e=>e.vote)),r=$((e=>e.theme)),o=$((e=>e.showComparison)),i=$((e=>e.rankedItems)),c=$((e=>e.year)),m=$((e=>e.globalSearch)),[d,y]=C.useState("None"),f=e=>{var a,s;if(!(null==e?void 0:e.length)||"loading"===e)return"All";const l=e.split("-")[2];return l?null==(s=null==(a=t.filter((e=>e.key===l)))?void 0:a[0])?void 0:s.name:"All"},[N,w]=C.useState((()=>f(n))),[k,S]=C.useState(["All",...t.sort(((e,a)=>e.name.localeCompare(a.name))).map((e=>e.name))]);C.useEffect((()=>{y("ab"===r?"Auroral":"None")}),[r]),C.useEffect((()=>{const e=f(n);e!==N&&w(e)}),[n]);const A=(e,s)=>{const t=p(n,e,s);t!==n&&(l(u(t)),a({v:t}))};return C.useEffect((()=>{(async()=>{var e;if("loading"===n)return;let s=(null==(e=null==n?void 0:n.split("-"))?void 0:e[1])??"",r=(e=>{var a,s;return(null==e?void 0:e.length)&&"All"!==e?null==(s=null==(a=t.filter((a=>a.name===e)))?void 0:a[0])?void 0:s.key:""})(N),o=`f-${s}-${r}`;await async function(e,a){if(m){let s=await v(e,a);l(g(s))}else{let e=await j(a,c);l(b(e))}}(i,o),o!==n&&(a({v:o}),l(u(o)))})()}),[N]),e.jsxs("div",{className:"mb-0",children:[e.jsx("div",{children:e.jsxs("div",{className:"mb-[0.5em] border-slate-700 border-b-[1px] pb-2 -mt-2",children:[e.jsxs("span",{className:"flex items-center ml-2",children:[e.jsx(O,{content:"Select which types of votes to display with each ranked country"}),e.jsx("span",{className:"ml-3 text-sm font-semibold",children:"Show Votes:"}),e.jsx(ae,{id:"total-checkbox",checked:h(n,"t"),onChange:e=>A("t",e),label:"Total"}),e.jsx(ae,{id:"tele-checkbox",checked:h(n,"tv"),onChange:e=>A("tv",e),label:"Tele",className:"ml-[0.5em]"}),e.jsx(ae,{id:"jury-checkbox",checked:h(n,"j"),onChange:e=>A("j",e),label:"Jury",className:"ml-[0.5em]"})]}),e.jsxs("div",{className:"mt-[0.5em]",children:[e.jsx(O,{content:"Choose which country to display voting counts from. 'All' will show the total vote count",className:"ml-4"}),e.jsx("span",{className:"ml-3 text-sm font-semibold",children:"From:"}),e.jsx(Y,{className:"ml-5 min-w[6em] mx-auto mb-2",menuClassName:"w-auto",value:N,onChange:e=>w(e),options:k,showSearch:!0},"country-selector-2")]})]})}),e.jsx("div",{children:e.jsx("div",{className:"mt-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx(O,{content:"When viewing a category ranking, also display the contestant's rank in each other category",className:"ml-4 pb-1"}),e.jsx(ae,{id:"total-checkbox",checked:o,onChange:e=>{return a({cm:!0===(t=e)?"t":"f"}),void l(s(!0===t));var t},label:"Show Category Comparisons"})]}),e.jsx("span",{className:"ml-5 font-semibold text-sm mb-[0.7em]",children:"Theme:"}),e.jsx(Y,{className:"ml-5 w-30 mx-auto mb-3",menuClassName:"",value:d,onChange:e=>{"Auroral"===e?(l(x("ab")),a({t:"ab"})):(l(x("")),a({t:""}))},options:["None","Auroral"],showSearch:!1},"theme-selector")]})})})]})},ne=a=>e.jsx("span",{className:T("px-2 py-0.5 bg-blue-500 text-white text-xs font-semibold rounded-full",a.className),children:"Beta"}),re=()=>{var l;const r=z(),o=$((e=>e.year)),i=$((e=>e.categories)),c=$((e=>e.activeCategory)),[m,h]=C.useState((null==(l=y(o))?void 0:l.length)>1?"Televote":"Total"),[x,p]=C.useState([]),[u,v]=C.useState([]),[g,j]=C.useState(new Map),b=$((e=>e.showComparison)),M=$((e=>e.globalSearch)),E=async(e,a,s)=>{var l;const r=new Map,o=await n(s,"");for(const n of t){const a=await T(e,m,"final",o,n.key);r.has(a)?null==(l=r.get(a))||l.push(n):r.set(a,[n])}return r},T=async(e,a,s,t,l)=>(t=await d(t,a,s,l)).filter((e=>{var a;return void 0!==(null==(a=null==e?void 0:e.contestant)?void 0:a.votes)})).map((a=>e?a.uid:null==a?void 0:a.id)).join("");const R=(e,a)=>`${e.charAt(0).toUpperCase()+e.slice(1)}: ${a}`,W=(e,a)=>`?r=${e.list2Code}&y=${o.substring(2,4)}&n=${R(m,a).replaceAll(" ","+")}&v=f-${N(m)}-${w(a)}`,D=e=>{const a=Math.round(10*e)/10;return a%1==0?a.toFixed(0):a.toFixed(1)},B=(s,t)=>e.jsxs("div",{className:"mt-4",children:[e.jsxs("p",{className:"text-sm mb-2",children:[t," ",m," rankings:"]}),e.jsx("div",{className:"grid grid-cols-[auto,1fr] gap-x-4 gap-y-2",children:s.flatMap((s=>{return(t=[s],l=g,t.flatMap((e=>l.get(e.list2Code)??[])).map((e=>e.name)).sort(((e,a)=>null==e?void 0:e.localeCompare(a)))).map(((t,l)=>e.jsxs(S.Fragment,{children:[e.jsx("div",{className:"whitespace-nowrap flex items-center",children:e.jsx("a",{href:W(s,t),target:"_blank",rel:"noopener noreferrer",className:" text-blue-500 hover:underline",title:R(m,t),children:e.jsxs("span",{className:"mt-auto",children:[t," (",D(s.percentSimilarity),"%)"]})})}),e.jsx("div",{children:e.jsx(A,{className:"pl-[0.7em] py-[0.5em] pr-[1em]",onClick:()=>((e,s)=>{const t=k("r");let l=[...i];if(t){const e={name:"Original",weight:5};l=[...l,e]}const n={name:s,weight:0},o=[...l,n];F(o,r,l,c),a({[`r${o.length}`]:e})})(s.list2Code,R(m,t)),icon:void 0,title:"Add as Category"})})]},`${s.list2Code}-${l}`)));var t,l}))})]});return e.jsxs("div",{className:"mb-0",children:[e.jsxs("div",{className:"relative mb-[1em] mt-2 flex items-center",children:[e.jsx("div",{className:"flex justify-center items-center mr-3 ml-3",children:e.jsx(ne,{className:"flex-shrink-0"})}),e.jsx("p",{className:"text-sm mr-1",children:"Compare your current ranking with the Jury or Tele vote from each participating country"})]}),e.jsxs("div",{className:"mt-5 mb-[1.5em]",children:[e.jsx("div",{children:e.jsx(Y,{className:"z-50 ml-3 mx-auto mb-2",menuClassName:"w-auto",value:m,onChange:e=>{h(e),p([]),v([])},options:y(o),showSearch:!1},"vote-type-selector")}),e.jsxs("div",{className:"mb-1",children:[e.jsx(O,{content:"When viewing a category ranking, also display the contestant's rank in each other category",className:"ml-2 pb-1"}),e.jsx(ae,{id:"total-checkbox",checked:b,onChange:e=>{return a({cm:!0===(t=e)?"t":"f"}),void r(s(!0===t));var t},label:"Show Category Comparisons"})]}),e.jsx(A,{className:"ml-3 pl-[0.7em] py-[0.5em] pr-[1em]",onClick:async()=>await(async()=>{const e=f(c).rankings,a=await E(M,0,o);j(a);const s=Array.from(a.keys()),t=await I(o,e,s);p(t)})(),icon:void 0,title:"Most similar"}),e.jsx(A,{className:"ml-3 font-normal pl-[0.7em] rounded-md text-xs py-[0.5em] pr-[1em]",onClick:async()=>await(async()=>{const e=f(c).rankings,a=await E(M,0,o);j(a);const s=Array.from(a.keys()),t=await U(o,e,s);v(t)})(),icon:void 0,title:"Most dissimilar"})]}),x.length>0&&B(x,"Most similar"),u.length>0&&B(u,"Most dissimilar")]})},oe=a=>{const[s,t]=C.useState(a.tab),l=$((e=>e.globalSearch)),n=$((e=>e.rankedItems));return new Set(n.map((e=>{var a;return null==(a=e.contestant)?void 0:a.year})).filter(Boolean)).size,C.useEffect((()=>{a.isOpen&&t(a.tab)}),[a.tab,a.isOpen]),e.jsxs(K,{isOpen:a.isOpen,onClose:a.onClose,className:"",children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 -mt-4",children:e.jsxs("ul",{className:"flex flex-wrap -mb-px text-sm font-medium text-center text-gray-500 dark:text-gray-400",children:[e.jsx(P,{isActive:"rankings"===s,onClick:()=>t("rankings"),icon:B,label:"Rankings"}),e.jsx(P,{isActive:"display"===s,onClick:()=>t("display"),icon:L,label:"Display"}),e.jsx(P,{isActive:"export"===s,onClick:()=>t("export"),icon:V,label:"Export"}),e.jsx(P,{isActive:"categories"===s,onClick:()=>t("categories"),icon:J,label:"Categories"}),!l&&e.jsx(P,{isActive:"analyze"===s,onClick:()=>t("analyze"),icon:X,label:"Analyze"})]})}),e.jsxs("div",{className:"overflow-y-auto pt-4 select-text pb-3 flex-grow",children:["display"===s&&e.jsx(le,{}),"rankings"===s&&e.jsx(te,{}),"export"===s&&e.jsx(ee,{}),"categories"===s&&e.jsx(se,{}),"analyze"===s&&e.jsx(re,{})]})]})};export{oe as default};
