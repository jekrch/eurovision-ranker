import{j as e,u as a,M as s,N as t,z as l,f as n,O as r,Q as i,R as o,S as c,T as m,U as d,V as x,W as p,X as u,Y as h,Z as v,A as j}from"./index-NHNyh55v.js";import{r as y,R as g}from"./redux-BaDTb7KV.js";import{u as b,I as f,y as N,a3 as w,l as C,a4 as k,a5 as S,T as $,a6 as A,a7 as R,c as z,a8 as M,a9 as T,Z as D,v as E,w as F,aa as O,t as I,ab as U}from"./App-Dp_AYPBw.js";import{D as W}from"./Dropdown-4U7EG2SM.js";import{E as Y,c as B,a as J,g as L,b as V,d as X}from"./ExportUtil-BE_cSTEF.js";import{C as Z,D as G}from"./DisplayTab-iXrFAS0M.js";import{T as K}from"./TabButton-D-HKYmiU.js";import"./react-D41Hy763.js";const Q=()=>{const[a,s]=y.useState("Text"),t=Object.values(Y).map((e=>e)),l=b((e=>e.rankedItems));return e.jsxs("div",{className:"mb-0",children:[e.jsx("div",{className:"mb-[1.5em]",children:e.jsx(f,{className:"pl-[0.7em] ml-0 py-[0.5em] px-[1em]",onClick:B,icon:N,title:"Copy URL to Clipboard"})}),e.jsx(W,{className:"z-50 w-20 h-10 mx-auto",menuClassName:"",value:a,onChange:e=>s(e),options:t,showSearch:!1},"type-selector"),e.jsxs("div",{children:[e.jsx(f,{className:"ml-0 pl-[0.7em] rounded-md text-xs py-[0.5em] pr-[1em]",onClick:async function(){let e=await L(a,l),s=V(a);X(e,null==s?void 0:s.fileExtension)},icon:w,title:"Download"}),e.jsx(f,{className:"ml-4 pl-[0.7em] py-[0.5em] pr-[1em]",onClick:()=>J(l,a),icon:N,title:"Copy to Clipboard"})]})]})},_=()=>{const t=C(),l=b((e=>e.categories)),n=b((e=>e.activeCategory)),[r,i]=y.useState(""),o=b((e=>e.showComparison)),c=()=>{if(""!==r.trim()){if(!R(r,l))return;const e=[...l,{name:r,weight:5}];i(""),k(e,t,l,n)}};return e.jsxs("div",{className:"mb-0",children:[e.jsxs("p",{className:"relative mb-[1em] mt-2 text-sm",children:["Create categories to build multiple rankings based on different criteria: e.g. ",e.jsx("i",{children:"Vocals, Dance, Lyrics"})," ","etc."]}),e.jsxs("div",{className:"mt-5 mb-[1.5em]",children:[e.jsx("span",{className:"font-bold ml-0 whitespace-nowrap",children:"Categories"}),e.jsxs("div",{className:"mt-4",children:[e.jsx("input",{type:"text",placeholder:"Enter category name",value:r,onChange:e=>i(e.target.value),onKeyDown:e=>{"Enter"===e.key&&c()},className:"px-2.5 py-1.5 ml-1 mr-3 border text-[var(--er-text-primary)] text-sm rounded-lg bg-[var(--er-border-subtle)] border-[var(--er-border-medium)] placeholder-[var(--er-text-subtle)]"}),e.jsx(f,{className:"ml-1 pl-[0.7em] py-[0.5em] pr-[1em]",onClick:c,icon:void 0,title:"Add"}),(null==l?void 0:l.length)>0&&e.jsx(f,{className:"ml-3 mt-2 bg-rose-800 hover:bg-rose-700 text-white font-normal pl-[0.7em] py-[0.5em] pr-[1em]",onClick:()=>{k([],t,l,n)},disabled:!(null==l?void 0:l.length),icon:S,title:"Clear"})]}),e.jsxs("div",{className:"mt-1",children:[e.jsx($,{content:"When viewing a category ranking, also display the contestant's rank in each other category",className:"ml-2 pb-1"}),e.jsx(Z,{id:"total-checkbox",checked:o,onChange:e=>{return a({cm:!0===(l=e)?"t":"f"}),void t(s(!0===l));var l},label:"Show Category Comparisons"})]}),e.jsxs("table",{className:"mt-4 w-full table-auto",children:[(null==l?void 0:l.length)>0&&e.jsx("thead",{children:e.jsxs("tr",{className:"text-sm",children:[e.jsx("th",{className:"text-left px-2",children:"Name"}),e.jsx("th",{className:"text-left px-2",children:"Weight"}),e.jsx("th",{className:"px-2"})]})}),e.jsx("tbody",{children:l.map(((a,s)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 py-2",children:e.jsx("input",{type:"text",value:a.name,onChange:e=>((e,a)=>{if(!R(a,l))return;let s=[...l];s[e]={...l[e],name:a},k(s,t,l,n)})(s,e.target.value),className:"px-2.5 py-1.5 mr-3 text-[var(--er-text-primary)] text-sm rounded-lg bg-[var(--er-border-subtle)] border-[var(--er-border-medium)] placeholder-[var(--er-text-subtle)] w-full"})}),e.jsx("td",{className:"px-2",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"range",min:"0",max:"10",step:"1",value:a.weight,onChange:e=>((e,a)=>{let s=[...l];s[e]={...s[e],weight:a},k(s,t,l,n)})(s,parseInt(e.target.value)),className:"w-full range accent-[var(--er-button-primary)]"}),e.jsx("span",{className:"ml-2 w-3",children:a.weight})]})}),e.jsx("td",{className:"px-2",children:e.jsx("button",{onClick:()=>A(s,t,l,n),className:"bg-rose-800 hover:bg-rose-700 text-white rounded-md px-[0.5em] py-[0.1em]",children:"X"})})]},s)))})]})]})]})},q=()=>{const a=b((e=>e.year)),s=b((e=>e.theme)),[p,u]=y.useState("2026"!==a?a:"2025"),[h,v]=y.useState("All"),[j,g]=y.useState(["All",...t.sort(((e,a)=>e.name.localeCompare(a.name))).map((e=>e.name))]),[N,w]=y.useState(!1),[C,k]=y.useState(!1),[S,A]=y.useState(["",...t.sort(((e,a)=>e.name.localeCompare(a.name))).map((e=>e.name))]),[R,z]=y.useState(""),[M,T]=y.useState("Year");y.useEffect((()=>{(async()=>{const e=await n(p,void 0);g(["All",...e.map((e=>e.country)).sort(((e,a)=>e.name.localeCompare(a.name))).map((e=>e.name))]),k(r(e)),w(i(e))})()}),[p]);const D=async(e,s,l,r)=>{var i;let o,c;(null==r?void 0:r.length)&&"All"!==r&&(c=null==(i=t.find((e=>e.name===r)))?void 0:i.key,c&&(o=`${l}-${s}-${c}`));let m=await n(e,o);if("1956"===d(a))return m.filter((e=>{var a;return"1"===(null==(a=e.contestant)?void 0:a.finalsRank.toString())})).map((e=>e.id)).join("");m=await x(m,s,l,c);return m.filter((e=>{var a;return void 0!==(null==(a=null==e?void 0:e.contestant)?void 0:a.votes)})).map((e=>e.id)).join("")},E=async(e=!1)=>{let a=await o(R);switch(e&&(a=a.filter((e=>e.finalsRank))),M){case"Year":a=a.sort(((e,a)=>Number(a.year)-Number(e.year)));break;case"Rank":a=a.sort(((e,a)=>e.finalsRank||a.finalsRank?e.finalsRank?a.finalsRank?Number(e.finalsRank)-Number(a.finalsRank):-1:1:0))}const t=a.map((e=>e.id)).join("");c(`?r=>${t}&g=t&`+("Rank"===M?"pl=t&":"")+`n=${encodeURIComponent(R)}&`,s)},F=async e=>{const s=p??a;return`?r=${await D(s,"televote","final",e)}&y=${s.substring(2,4)}&n=Final+Televote${I(e)}&v=${m("f","tv",e)}`},O=async e=>{const s=p??a;return`?r=${await D(s,"jury","final",e)}&y=${s.substring(2,4)}&n=Final+Jury${I(e)}&v=${m("f","j",e)}`},I=e=>(null==e?void 0:e.length)&&"All"!==e?`+from+${encodeURIComponent(e).replaceAll(" ","+")}`:"";return e.jsxs("div",{className:"mb-0",children:[e.jsx("p",{className:"relative mb-[1em] mt-2 text-sm",children:"Generate rankings based on selected year, or see all contestants for a selected country."}),e.jsxs("div",{className:"mt-5",children:[e.jsx("span",{className:"font-bold ml-0 whitespace-nowrap",children:"ESC final rankings"}),e.jsx($,{content:"Select a year and voting country, then click one of the buttons to see official final rankings",className:"ml-0 z-50"}),e.jsxs("div",{className:" mt-[0.7em]",children:[e.jsxs("div",{children:[e.jsx(W,{className:"w-22 mx-auto mb-2",menuClassName:"",value:p??a,onChange:e=>u(e),options:l.filter((e=>"2020"!==e&&"2026"!==e)),showSearch:!0}),e.jsx("span",{className:"ml-2 text-sm",children:"from"}),e.jsx($,{content:"Choose which country to display voting counts from. 'All' will show the total vote count",className:"ml-4 z-50"}),e.jsx(W,{className:"ml-3 mx-auto mb-2",menuClassName:"w-auto",value:h,onChange:e=>v(e),options:j,showSearch:!0},"country-selector")]}),e.jsx("div",{className:"mt-2 ml-0",children:e.jsxs("span",{className:"",children:["2026"!==p?e.jsx(f,{onClick:async()=>{const e=p??a,t=await D(e,"total","final",h);c(`?r=${t}&y=${e.substring(2,4)}&n=Final${I(h)}&v=${m("f","t",h)}`,s)},className:"pl-[1em] pr-[1em] rounded-md",title:"total"}):e.jsx(e.Fragment,{children:"No voting data available yet for 2026"}),C&&e.jsx(f,{onClick:async()=>{const e=await F(h);c(e,s)},className:"ml-3 pl-[1em] pr-[1em] rounded-md",title:"televote"}),N&&e.jsx(f,{onClick:async()=>{const e=await O(h);c(e,s)},className:"ml-3 pl-[1em] pr-[1em] rounded-md",title:"jury"})]})})]})]}),e.jsxs("div",{className:"mt-5",children:[e.jsx("span",{className:"font-bold ml-0 whitespace-nowrap",children:"Contestants by country "}),e.jsx($,{content:"Display all past and current contestants for a specific country",className:"ml-0 z-50"}),e.jsx("div",{className:" mt-[0.7em]",children:e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx(W,{className:"mx-auto mb-2 min-w-[5em]",menuClassName:"w-auto",value:R,onChange:e=>z(e),options:S,showSearch:!0},"country-selector"),e.jsx("span",{className:"mx-2",children:"order by"}),e.jsx(W,{className:"mx-auto mb-2 min-w-[5em]",menuClassName:"w-auto",value:M,onChange:e=>T(e),options:["Year","Rank"],showSearch:!1},"country-order-selector")]}),e.jsxs("div",{className:"mt-2 -ml-4",children:[e.jsx(f,{onClick:E,className:"ml-4 pl-[1em] pr-[1em] rounded-md",title:"all",disabled:!R}),e.jsx(f,{onClick:()=>E(!0),className:"ml-4 pl-[1em] pr-[1em] rounded-md",title:"finalists",disabled:!R})]})]})})]})]})},H=a=>e.jsx("span",{className:z("px-2 py-0.5 bg-[var(--er-interactive-primary)] text-white text-xs font-semibold rounded-full",a.className),children:"Beta"}),P=()=>{var l;const r=C(),i=b((e=>e.year)),o=b((e=>e.categories)),c=b((e=>e.activeCategory)),[m,d]=y.useState((null==(l=p(i))?void 0:l.length)>1?"Televote":"Total"),[N,w]=y.useState([]),[S,A]=y.useState([]),[R,z]=y.useState(new Map),D=b((e=>e.showComparison)),E=b((e=>e.globalSearch)),F=async(e,a,s)=>{var l;const r=new Map,i=await n(s,"");for(const n of t){const a=await O(e,m,"final",i,n.key);r.has(a)?null==(l=r.get(a))||l.push(n):r.set(a,[n])}return r},O=async(e,a,s,t,l)=>(t=await x(t,a,s,l)).filter((e=>{var a;return void 0!==(null==(a=null==e?void 0:e.contestant)?void 0:a.votes)})).map((a=>e?a.uid:null==a?void 0:a.id)).join("");const I=(e,a)=>`${e.charAt(0).toUpperCase()+e.slice(1)}: ${a}`,U=(e,a)=>`?r=${e.list2Code}&y=${i.substring(2,4)}&n=${I(m,a).replaceAll(" ","+")}&v=f-${h(m)}-${v(a)}`,Y=e=>{const a=Math.round(10*e)/10;return a%1==0?a.toFixed(0):a.toFixed(1)},B=(s,t)=>e.jsxs("div",{className:"mt-4",children:[e.jsxs("p",{className:"text-sm mb-2",children:[t," ",m," rankings:"]}),e.jsx("div",{className:"grid grid-cols-[auto,1fr] gap-x-4 gap-y-2",children:s.flatMap((s=>{return(t=[s],l=R,t.flatMap((e=>l.get(e.list2Code)??[])).map((e=>e.name)).sort(((e,a)=>null==e?void 0:e.localeCompare(a)))).map(((t,l)=>e.jsxs(g.Fragment,{children:[e.jsx("div",{className:"whitespace-nowrap flex items-center",children:e.jsx("a",{href:U(s,t),target:"_blank",rel:"noopener noreferrer",className:" text-[var(--er-interactive-primary)] hover:underline",title:I(m,t),children:e.jsxs("span",{className:"mt-auto",children:[t," (",Y(s.percentSimilarity),"%)"]})})}),e.jsx("div",{children:e.jsx(f,{className:"pl-[0.7em] py-[0.5em] pr-[1em]",onClick:()=>((e,s)=>{const t=j("r");let l=[...o];if(t){const e={name:"Original",weight:5};l=[...l,e]}const n={name:s,weight:0},i=[...l,n];k(i,r,l,c),a({[`r${i.length}`]:e})})(s.list2Code,I(m,t)),icon:void 0,title:"Add as Category"})})]},`${s.list2Code}-${l}`)));var t,l}))})]});return e.jsxs("div",{className:"mb-0",children:[e.jsxs("div",{className:"relative mb-[1em] mt-2 flex items-center",children:[e.jsx("div",{className:"flex justify-center items-center mr-3 ml-3",children:e.jsx(H,{className:"flex-shrink-0"})}),e.jsx("p",{className:"text-sm mr-1",children:"Compare your current ranking with the Jury or Tele vote from each participating country"})]}),e.jsxs("div",{className:"mt-5 mb-[1.5em]",children:[e.jsx("div",{children:e.jsx(W,{className:"z-50 ml-3 mx-auto mb-2",menuClassName:"w-auto",value:m,onChange:e=>{d(e),w([]),A([])},options:p(i),showSearch:!1},"vote-type-selector")}),e.jsxs("div",{className:"mb-1",children:[e.jsx($,{content:"When viewing a category ranking, also display the contestant's rank in each other category",className:"ml-2 pb-1"}),e.jsx(Z,{id:"total-checkbox",checked:D,onChange:e=>{return a({cm:!0===(t=e)?"t":"f"}),void r(s(!0===t));var t},label:"Show Category Comparisons"})]}),e.jsx(f,{className:"ml-3 pl-[0.7em] py-[0.5em] pr-[1em]",onClick:async()=>await(async()=>{const e=u(c).rankings,a=await F(E,0,i);z(a);const s=Array.from(a.keys()),t=await M(i,e,s);w(t)})(),icon:void 0,title:"Most similar"}),e.jsx(f,{className:"ml-3 font-normal pl-[0.7em] rounded-md text-xs py-[0.5em] pr-[1em]",onClick:async()=>await(async()=>{const e=u(c).rankings,a=await F(E,0,i);z(a);const s=Array.from(a.keys()),t=await T(i,e,s);A(t)})(),icon:void 0,title:"Most dissimilar"})]}),N.length>0&&B(N,"Most similar"),S.length>0&&B(S,"Most dissimilar")]})},ee=a=>{const[s,t]=y.useState(a.tab),l=b((e=>e.globalSearch)),n=b((e=>e.rankedItems));return new Set(n.map((e=>{var a;return null==(a=e.contestant)?void 0:a.year})).filter(Boolean)).size,y.useEffect((()=>{a.isOpen&&t(a.tab)}),[a.tab,a.isOpen]),e.jsxs(D,{isOpen:a.isOpen,onClose:a.onClose,className:"",children:[e.jsx("div",{className:"border-b border-[var(--er-border-lightest)] dark:border-[var(--er-border-darker)] -mt-4",children:e.jsxs("ul",{className:"flex flex-wrap -mb-px text-sm font-medium text-center text-[var(--er-text-muted)] dark:text-[var(--er-text-subtle)]",children:[e.jsx(K,{isActive:"rankings"===s,onClick:()=>t("rankings"),icon:E,label:"Rankings"}),e.jsx(K,{isActive:"display"===s,onClick:()=>t("display"),icon:F,label:"Display"}),e.jsx(K,{isActive:"export"===s,onClick:()=>t("export"),icon:O,label:"Export"}),e.jsx(K,{isActive:"categories"===s,onClick:()=>t("categories"),icon:I,label:"Categories"}),!l&&e.jsx(K,{isActive:"analyze"===s,onClick:()=>t("analyze"),icon:U,label:"Analyze"})]})}),e.jsxs("div",{className:"overflow-y-auto pt-4 select-text pb-3 flex-grow",children:["display"===s&&e.jsx(G,{}),"rankings"===s&&e.jsx(q,{}),"export"===s&&e.jsx(Q,{}),"categories"===s&&e.jsx(_,{}),"analyze"===s&&e.jsx(P,{})]})]})};export{ee as default};
