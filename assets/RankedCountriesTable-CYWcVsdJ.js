import{z as e,u as s,A as a,B as t,k as l,C as r,D as n,E as c,P as o,F as i,i as d,n as m,G as h,H as x,I as u,t as g,j as p,e as f,q as j,J as y,x as w,l as b}from"./index-IoOm0Sy4.js";import{r as C}from"./redux-BaDTb7KV.js";import{j as N,u as v,b as S,A as k,B as P,D as z,E as _,G as T,c as D,T as E,H as L,I,J as R,K as U,S as A}from"./App-D2AfU061.js";import{R as G}from"./index-EIpLeGI0.js";import{D as $}from"./Dropdown-CNRxJens.js";import{M}from"./Modal-D6Cra0AX.js";import"./react-D41Hy763.js";const O=({handleSort:e,sortColumn:s,sortDirection:a,showSelected:t})=>{const l=({column:e})=>("country"===e&&(e="to_country"),s!==e?null:"asc"===a?p.jsx(S,{icon:k,className:"ml-2"}):p.jsx(S,{icon:P,className:"ml-2"}));return p.jsx("thead",{className:"bg-slate-700 text-slate-300 sticky top-0 z-40",children:p.jsxs("tr",{children:[p.jsx("th",{className:"py-3 text-center text-xs font-medium uppercase tracking-wider sticky left-0 z-50 bg-slate-700",children:t?"Del":"Add"}),["Year","Country","Performer","Song"].map((s=>p.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider cursor-pointer hover:bg-[#3068ba]",onClick:()=>e(s.toLowerCase()),children:p.jsxs("div",{className:"flex items-center whitespace-nowrap",children:[s,p.jsx(l,{column:s.toLowerCase()})]})},s)))]})})},B=({paginatedContestants:e,handleToggleSelected:s,showSelected:a,selectedContestants:t})=>p.jsx("tbody",{className:"bg-transparent divide-y divide-gray-700",children:e.map((e=>p.jsxs("tr",{className:"hover:bg-slate-800 bg-opacity-50 text-slate-300",children:[p.jsx("td",{className:"py-0 whitespace-nowrap sticky left-0 z-30 bg-slate-900 hover:bg-[#3068ba]",children:p.jsx("div",{className:"flex justify-center h-full",children:p.jsx(G,{className:"flex items-center justify-center w-full h-full",placeholder:p.jsx(p.Fragment,{}),children:p.jsx("button",{onClick:()=>s(e.id),className:"text-slate-300 hover:text-slate-100 p-2 rounded-md h-full w-full",children:a?p.jsx(S,{icon:z,className:"text-red-500"}):t.some((s=>s.id===e.id))?p.jsx(S,{icon:_,className:"text-green-500"}):p.jsx(S,{icon:T})})})})}),p.jsx("td",{className:"px-6 py-4 whitespace-nowrap overflow-x-clip",children:e.year}),p.jsx("td",{className:"px-6 py-4 whitespace-nowrap overflow-x-clip",children:e.to_country}),p.jsx("td",{className:"px-6 py-4 whitespace-nowrap overflow-x-clip",title:e.performer,children:e.performer}),p.jsx("td",{className:"px-6 py-4 whitespace-nowrap overflow-x-clip",title:e.song,children:e.song})]},e.id)))}),F=({searchTerm:e,handleSearch:s,className:a})=>p.jsxs("div",{className:D("w-full sm:w-auto flex-grow sm:flex-grow-0 flex items-center",a),children:[p.jsx(E,{content:'Search across all columns. To search for a phrase, enclose your search term in quotes "like this"',className:"mt-2 mr-3 pb-1"}),p.jsxs("div",{className:"relative w-full mr-3",children:[p.jsx("input",{type:"text",value:e,onChange:s,placeholder:"Search...",className:"text-sm w-full pl-10 pr-4 py-[0.4em] border rounded-md focus:outline-none focus:ring-2 focus:ring-slate-400 bg-transparent text-slate-300 border-slate-400"}),p.jsx(S,{icon:L,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400"})]})]}),H=({pageSize:e,currentPage:s,totalPages:a,displayedContestants:t,handlePageSizeChange:l,handlePageChange:r})=>p.jsxs("div",{className:"mt-1 flex justify-between px-2",children:[p.jsxs("div",{children:[p.jsx($,{value:`${e}`,onChange:l,options:["10","25","50"],buttonClassName:"",className:"min-w-[0.9em] text-xs mt-2",openUpwards:!0,mini:!0}),p.jsxs("span",{className:D("text-sm text-gray-300 ml-2 mr-3 whitespace-nowrap","text-xs mr-1"),children:["of ",t.length]})]}),p.jsx("div",{className:"space-x-1 space-y-2",children:p.jsxs(p.Fragment,{children:[p.jsx("button",{onClick:()=>r(1),disabled:1===s,className:"text-sm px-2 py-1 rounded bg-gray-700 text-gray-300 hover:bg-gray-600 disabled:opacity-50",children:"<<"}),p.jsx("button",{onClick:()=>r(s-1),disabled:1===s,className:"text-sm px-2 py-1 rounded bg-gray-700 text-gray-300 hover:bg-gray-600 disabled:opacity-50",children:"<"}),p.jsxs("span",{className:"text-sm text-gray-300",children:[s," / ",a]}),p.jsx("button",{onClick:()=>r(s+1),disabled:s===a,className:"text-sm px-2 py-1 rounded bg-gray-700 text-gray-300 hover:bg-gray-600 disabled:opacity-50",children:">"}),p.jsx("button",{onClick:()=>r(a),disabled:s===a,className:"text-sm px-2 py-1 rounded bg-gray-700 text-gray-300 hover:bg-gray-600 disabled:opacity-50",children:">>"})]})})]}),q=({isOpen:e,onClose:s,onConfirm:a,message:t})=>p.jsxs(M,{isOpen:e,onClose:s,className:"max-w-[28em]",closeBtnClassName:"hidden",children:[p.jsx("div",{className:"mb-4 text-sm text-gray-900 dark:text-slate-300 whitespace-pre-line leading-[1.2em]",children:t}),p.jsxs("div",{className:"float-right mt-1 -mb-1",children:[p.jsx(I,{className:"",onClick:()=>{a(),s()},title:"Confirm"}),p.jsx(I,{className:"ml-2",onClick:s,title:"Cancel",isGrayTheme:!0})]})]}),J=()=>{const S=N(),k=v((e=>e.showUnranked)),P=v((e=>e.rankedItems)),z=v((e=>e.tableState)),{sortColumn:_,sortDirection:T}=z,[L,G]=C.useState(!1),$=v((e=>e.activeCategory)),M=R(),{refreshUrl:J}=U(),Y=(()=>{const e=v((e=>e.rankedItems)),s=v((e=>e.globalSearch)),t=v((e=>e.categories));return C.useCallback((l=>{let r=s;void 0!==l&&(r=l),a(t,r,e)}),[s,e])})(),{paginatedContestants:K,handleSort:V,handleSearch:W,handlePageSizeChange:Q,handlePageChange:X,handleToggleSelected:Z,searchTerm:ee,showSelected:se,setShowSelected:ae,globalSearch:te,updateGlobalSearch:le,pageSize:re,currentPage:ne,totalPages:ce,displayedContestants:oe,selectedContestants:ie}=(()=>{const p=N(),f=v((e=>e.tableState)),j=v((e=>e.rankedItems)),y=v((e=>e.globalSearch)),w=v((e=>e.categories)),b=v((e=>e.activeCategory)),{sortColumn:S,sortDirection:k,pageSize:P,currentPage:z,entries:_,selectedContestants:T}=f,[D,E]=C.useState(""),[L,I]=C.useState(!1),R=C.useRef([]),U=C.useRef([]);C.useEffect((()=>{y&&(async()=>{try{let e=_;if(!(null==_?void 0:_.length)){const s=await n(),a=await s;e=$(a),p(c(e))}if(j.length>0){const s=new Set(j.map((e=>e.uid))),a=e.filter((e=>s.has(e.id)));M(a,T)||p(l(a))}G()}catch(e){}})()}),[y,_.length,j,p]);const A=C.useCallback((()=>{j.map((e=>e.uid)).join("");const a={};w.forEach(((s,t)=>{const l=`r${t+1}`,r=e(l)||"";a[l]=r})),s(a)}),[j,w]),G=C.useCallback((()=>{a(w,y,j)}),[y,j,w]),$=e=>o.parse(e,{header:!0,skipEmptyLines:!0,transformHeader:e=>e.trim(),transform:e=>e.trim()}).data.map((e=>({id:e.id,year:parseInt(e.year,10),to_country_id:e.to_country_id,to_country:e.to_country,performer:e.performer,song:e.song,place_contest:parseInt(e.place_contest,10)}))).filter((e=>e.year&&e.to_country&&e.performer&&e.song)),M=(e,s)=>{if(e.length!==s.length)return!1;for(let a=0;a<e.length;a++)if(e[a].id!==s[a].id||e[a].year!==s[a].year)return!1;return!0};C.useEffect((()=>{(async()=>{if(M(R.current,T))return;const s=e("v")??"";try{const e=j||[],a=new Set(e.map((e=>e.uid))),t=new Set(T.map((e=>e.id))),l=T.filter((e=>!a.has(e.id))).map((e=>e.id)),r=e.filter((e=>!t.has(e.uid))).map((e=>e.uid)),n=await i(l,s),c=[...e.filter((e=>!r.includes(e.uid))),...n];((e,s)=>{if(e.length!==s.length)return!1;for(let a=0;a<e.length;a++)if(e[a].uid!==s[a].uid)return!1;return!0})(c,U.current)||(p(d(c)),m(b,w,c),U.current=c),R.current=T}catch(a){}})()}),[T,b,w,j,p]),C.useEffect((()=>{p(t(1)),E("")}),[L,p]);const O=C.useMemo((()=>{const e=L?T:_,s=new Set;let a=e.filter((e=>!s.has(e.id)&&(s.add(e.id),!0)));if(D){const e=/^".*"$/.test(D.trim())?[D.trim().slice(1,-1).toLowerCase()]:D.toLowerCase().split(/\s+/);a=a.filter((s=>e.every((e=>Object.entries(s).some((([s,a])=>"id"!==s&&String(a).toLowerCase().includes(e)))))))}return S&&a.sort(((e,s)=>e[S]<s[S]?"asc"===k?-1:1:e[S]>s[S]?"asc"===k?1:-1:0)),a}),[_,T,L,D,S,k]),B=Math.ceil(O.length/P),F=O.slice((z-1)*P,z*P),H=C.useCallback(((e,a)=>{w.forEach(((t,l)=>{const r=`r${l+1}`;let n,c=new URLSearchParams(window.location.search).get(r)||"";c.startsWith(">")||(c=`>${c}`),n=a?c+e:c.replace(e,""),s({[r]:n})}))}),[w]),q=C.useCallback((e=>{let s;if(T.some((s=>s.id===e)))s=T.filter((s=>s.id!==e)),H(e,!1);else{const a=f.entries.find((s=>s.id===e));if(!a)return;s=[...T,a],H(e,!0)}p(l(s)),y&&A()}),[T,f.entries,p,H,y,A,G]);return C.useEffect((()=>{M(f.paginatedContestants,F)||p(r(F))}),[f.currentPage,f.filters,f.entries,f.sortDirection,f.sortColumn,f.pageSize]),{paginatedContestants:F,handleSort:e=>{"country"===e&&(e="to_country"),p(h(e))},handleSearch:e=>{E(e.target.value),p(x({search:e.target.value}))},handlePageSizeChange:e=>{p(u(Number(e)))},handlePageChange:e=>{p(t(e))},handleToggleSelected:q,searchTerm:D,showSelected:L,setShowSelected:I,globalSearch:y,updateGlobalSearch:e=>{s({g:e?"t":void 0}),p(g(e)),G()},pageSize:P,currentPage:z,totalPages:B,displayedContestants:O,selectedContestants:T,convertRankingURLParams:G}})(),de=()=>{le(!1),Y(!1)};return p.jsxs("div",{className:"flex flex-col h-full bg-transparent text-slate-300",children:[p.jsxs("div",{className:D("flex flex-col mb-1 pr-1 sm:flex-row sm:items-center sm:space-x-4"),children:[p.jsx("div",{className:D("w-full xs:w-1/2"),children:p.jsx(F,{searchTerm:ee,handleSearch:W,className:"w-full mb-1"})}),p.jsxs("div",{className:D("flex items-center justify-between pb-1 text-sm mt-1 sm:mt-0 sm:justify-end sm:flex-grow min-w-[50%]"),children:[p.jsx(A,{label:"selected",className:"text-base",labelClassName:"text-slate-400",checked:se,setChecked:ae}),p.jsxs("div",{className:"flex items-center gap-1 mr-3",children:[p.jsxs("div",{className:"flex items-center",children:[p.jsx(E,{content:"Uncheck this to use the simple year-based selection mode",className:"text-slate-300 align-middle mb-0 -mr-1"}),p.jsx(A,{label:"adv",className:"items-center align-middle",labelClassName:"text-base text-slate-400",checked:te,setChecked:async e=>{if(e)le(e);else if(j($)){const e=y(P);1===(null==e?void 0:e.length)?(S(w(e[0])),de(),J(),await b($,S)):G(!0)}else M(),de()}})]}),p.jsx(I,{className:D("tada-animation pl-[0.7em] pr-[0.9em] w-[6em]",{"tada-animation":k&&(null==P?void 0:P.length)}),onClick:()=>S(f(!k)),title:"View List"})]})]})]}),p.jsx(q,{isOpen:L,onClose:()=>G(!1),onConfirm:()=>{M(),de()},message:"Are you sure you want to turn off advanced global search mode? \n\nYour current selections will be cleared, since they contain contestants from multiple years."}),p.jsx("div",{className:"flex-grow overflow-auto !rounded-t-md !rounded-tr-md mr-1 shadow-xl",children:p.jsx("div",{className:"relative",children:p.jsxs("table",{className:"w-full bg-transparent table-fixed",children:[p.jsxs("colgroup",{children:[p.jsx("col",{className:"w-[3em]"}),p.jsx("col",{className:"w-24"}),p.jsx("col",{className:"w-40"}),p.jsx("col",{className:"w-48"}),p.jsx("col",{className:"w-64"})]}),p.jsx(O,{handleSort:V,sortColumn:_,sortDirection:T,showSelected:!1}),p.jsx(B,{paginatedContestants:K,handleToggleSelected:Z,showSelected:se,selectedContestants:ie})]})})}),p.jsx(H,{pageSize:re,currentPage:ne,totalPages:ce,displayedContestants:oe,handlePageSizeChange:Q,handlePageChange:X})]})},Y=()=>{const[e,s]=C.useState(0),a=v((e=>e.rankedItems)),t=v((e=>e.categories)),l=v((e=>e.activeCategory));return C.useEffect((()=>{0!==e&&m(l,t,a)}),[e]),p.jsx("div",{className:"z-20",children:p.jsx("div",{className:D("grid h-full max-h-full min-h-full grid-rows-[auto_1fr]"),children:p.jsx("div",{className:"overflow-y-auto h-full",children:p.jsx(J,{})})})})};export{Y as default};
