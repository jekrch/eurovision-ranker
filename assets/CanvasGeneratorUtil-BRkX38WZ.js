import{n as t}from"./App-CmgZ6DIL.js";import"./index-DJml4fkD.js";import"./react-D41Hy763.js";import"./redux-BaDTb7KV.js";const e={baseItemHeight:70,itemMargin:12,canvasWidth:800,padding:20,columnPadding:20,headerHeight:60,footerMargin:10,itemPadding:8,rankBoxWidth:55,rankBoxColor:"#48488a",flagBoxWidth:60,flagBoxHeight:45,flagBoxColor:"#3A3A6A",textBoxColor:"transparent",boxGap:15,textPaddingLeft:20,cardCornerRadius:8,boxCornerRadius:4,fontFamily:"Arial, sans-serif",pixelRatio:2,fontSizes:{title:26,rankNumber:25,artist:15,song:13}},o={background:"#1E1E3F",headerGradient:["#3B3B7A","#2A2A5F"],cardBackground:"#2C2C54",titleText:"#E0E0FF",rankText:"#FFFFFF",artistText:"#D0D0F0",songText:"#B0B0D0",footerText:"#A0A0C0",shadow:"rgba(0, 0, 0, 0.2)"},a=(t,e,o)=>new Promise(((a,n)=>{fetch(t,{mode:"cors",headers:{Origin:window.location.origin}}).then((e=>{if(!e.ok)throw new Error(`Failed to load SVG: ${e.status} ${e.statusText} from ${t}`);return e.text()})).then((i=>{const r=new Blob([i],{type:"image/svg+xml"}),l=URL.createObjectURL(r),s=new Image(e,o);s.onload=()=>{URL.revokeObjectURL(l),a(s)},s.onerror=e=>{URL.revokeObjectURL(l),n(new Error(`Failed to load SVG image from data URL (original: ${t}): ${e}`))},s.src=l})).catch((t=>n(t)))})),n=(t,e="normal")=>new Promise((o=>{const a=`${e} 16px ${t}`;document.fonts&&"function"==typeof document.fonts.check?document.fonts.ready.then((()=>{if(document.fonts.check(a))return void o(!0);new FontFace(t,`local('${t}')`,{weight:e}).load().then((t=>{document.fonts.add(t),o(!0)})).catch((()=>{o(!1)}))})).catch((()=>{o(!1)})):o(!0)})),i=(t,e,o,a,n,i=4,r=!0,l=!1)=>{a<2*i&&(i=a/2),n<2*i&&(i=n/2),t.beginPath(),t.moveTo(e+i,o),t.arcTo(e+a,o,e+a,o+n,i),t.arcTo(e+a,o+n,e,o+n,i),t.arcTo(e,o+n,e,o,i),t.arcTo(e,o,e+a,o,i),t.closePath(),r&&t.fill(),l&&t.stroke()},r=(t,e,o,a,n,r,l)=>{t.fillStyle=l.flagBoxColor,i(t,o,a,n,r,l.boxCornerRadius),t.fillStyle=(t=>{const e={al:"#dc3545",am:"#dc3545",au:"#28a745",at:"#dc3545",az:"#17a2b8",be:"#000000",hr:"#dc3545",cy:"#ffc107",cz:"#fd7e14",dk:"#343a40",ee:"#6f42c1",fi:"#28a745",fr:"#0d6efd",ge:"#dc3545",de:"#6c757d",gr:"#28a745",is:"#fd7e14",ie:"#28a745",il:"#28a745",it:"#28a745",lv:"#6f42c1",lt:"#ffc107",lu:"#dc3545",mt:"#28a745",me:"#6c757d",nl:"#fd7e14",no:"#dc3545",pl:"#6c757d",pt:"#28a745",sm:"#28a745",rs:"#dc3545",si:"#28a745",es:"#6f42c1",se:"#28a745",ch:"#6f42c1",ua:"#28a745",gb:"#28a745",uk:"#28a745"};if(e[t.toLowerCase()])return e[t.toLowerCase()];let o=0;for(let n=0;n<t.length;n++)o=t.charCodeAt(n)+((o<<5)-o);let a="#";for(let n=0;n<3;n++){const t=o>>8*n&255;a+=("00"+Math.min(Math.max(t,60),200).toString(16)).slice(-2)}return a})(e);t.fillRect(o+2,a+2,n-4,r-4),t.fillStyle="#ffffff",t.font=`bold ${Math.min(16,r-8)}px ${l.fontFamily}`,t.textAlign="center",t.textBaseline="middle",t.fillText(e.toUpperCase(),o+n/2,a+r/2)},l=(t,e,o,a)=>{if(o<=0)return[e];const n=e.split(" "),i=[];let r=n[0]||"";t.font=a;for(let l=1;l<n.length;l++){const e=n[l],a=r+" "+e,{width:s}=t.measureText(a);s<o&&r?r=a:(r&&i.push(r),r=e)}return r&&i.push(r),i.filter((t=>""!==t.trim()))},s=(t,e,o,a,n,s,d,c,f,g)=>{const{country:h,contestant:m}=e;t.save(),t.shadowColor=f.shadow,t.shadowBlur=5,t.shadowOffsetX=2,t.shadowOffsetY=2,t.fillStyle=f.cardBackground,i(t,n,s,d,c,g.cardCornerRadius,!0,!1),t.restore();const x=n+g.itemPadding,u=s+g.itemPadding,p=c-2*g.itemPadding;let y=g.rankBoxColor;1===a?y="#a807de":2===a?y="#7c07a3":3===a&&(y="#591a8a"),t.fillStyle=y,i(t,x,u,g.rankBoxWidth,p,g.boxCornerRadius),t.fillStyle=f.rankText,t.font=`bold ${g.fontSizes.rankNumber}px ${g.fontFamily}`,t.textAlign="center",t.textBaseline="middle",t.fillText(a.toString(),x+g.rankBoxWidth/2,u+p/2);const w=x+g.rankBoxWidth+g.boxGap,b=s+(c-g.flagBoxHeight)/2;o?((t,e,o,a,n,l,s,d)=>{t.save(),t.fillStyle=d.flagBoxColor,i(t,a,n,l,s,d.boxCornerRadius,!0,!1),t.beginPath(),t.moveTo(a+d.boxCornerRadius,n),t.arcTo(a+l,n,a+l,n+s,d.boxCornerRadius),t.arcTo(a+l,n+s,a,n+s,d.boxCornerRadius),t.arcTo(a,n+s,a,n,d.boxCornerRadius),t.arcTo(a,n,a+l,n,d.boxCornerRadius),t.closePath(),t.clip();const c=e.naturalWidth||e.width,f=e.naturalHeight||e.height;if(!c||!f)return t.restore(),void r(t,o,a,n,l,s,d);const g=c/f,h=l/s;let m=0,x=0,u=c,p=f;g>h?(u=f*h,m=(c-u)/2):g<h&&(p=c/h,x=(f-p)/2);try{t.drawImage(e,m,x,u,p,a,n,l,s)}catch(y){}t.restore()})(t,o,h.key,w,b,g.flagBoxWidth,g.flagBoxHeight,g):r(t,h.key,w,b,g.flagBoxWidth,g.flagBoxHeight,g);const k=w+g.flagBoxWidth+g.textPaddingLeft,C=s+g.itemPadding,S=d-(k-n)-g.itemPadding,B=c-2*g.itemPadding;"transparent"!==g.textBoxColor&&(t.fillStyle=g.textBoxColor,i(t,k,C,S,B,g.boxCornerRadius));const R=(null==m?void 0:m.artist)||"Unknown Artist",$=(null==m?void 0:m.song)?`"${m.song}"`:"",v=`bold ${g.fontSizes.artist}px ${g.fontFamily}`,F=`${g.fontSizes.song}px ${g.fontFamily}`,T=1.25,P=l(t,R,S,v);let A=P.length*g.fontSizes.artist*T,z=[];$&&(z=l(t,$,S,F),A+=5+z.length*g.fontSizes.song*T);let L=C+(B-A)/2;L=Math.max(L,C),t.textAlign="left",t.textBaseline="top",t.fillStyle=f.artistText,t.font=v,P.forEach((e=>{t.fillText(e,k,L),L+=g.fontSizes.artist*T})),$&&(L+=5,t.fillStyle=f.songText,t.font=F,z.forEach((e=>{t.fillText(e,k,L),L+=g.fontSizes.song*T})))},d=async(t,i="My Eurovision Ranking",r={},d={})=>{const c={...e,...r};c.fontSizes={...e.fontSizes,...r.fontSizes};const f={...o,...d},g=document.createElement("canvas"),h=g.getContext("2d");if(!h)throw new Error("Canvas 2D context not supported");await n(c.fontFamily,"normal"),await n(c.fontFamily,"bold");const m=(c.canvasWidth-2*c.padding-1*c.columnPadding)/2,x=t.map((t=>((t,e,o,a)=>{var n,i;const r=(null==(n=e.contestant)?void 0:n.artist)||"Unknown Artist",s=(null==(i=e.contestant)?void 0:i.song)?`"${e.contestant.song}"`:"",d=o-(a.itemPadding+a.rankBoxWidth+a.boxGap+a.flagBoxWidth+a.textPaddingLeft)-a.itemPadding;let c=0;const f=`bold ${a.fontSizes.artist}px ${a.fontFamily}`;if(c+=l(t,r,d,f).length*a.fontSizes.artist*1.25,s){c+=5;const e=`${a.fontSizes.song}px ${a.fontFamily}`;c+=l(t,s,d,e).length*a.fontSizes.song*1.25}const g=Math.max(a.flagBoxHeight,c);return Math.max(a.baseItemHeight,g+2*a.itemPadding)})(h,t,m,c))),u=Math.ceil(t.length/2);let p=Array(2).fill(0);for(let e=0;e<t.length;e++){const t=Math.floor(e/u);t<2?p[t]+=x[e]+c.itemMargin:p[1]+=x[e]+c.itemMargin}p=p.map((t=>t>0?t-c.itemMargin:0));const y=Math.max(0,...p),w=i&&""!==i.trim(),b=w?c.headerHeight:0,k=b+c.padding+y+c.padding+c.footerMargin+30,C=c.canvasWidth*c.pixelRatio,S=k*c.pixelRatio;g.width=C,g.height=S,g.style.width=`${c.canvasWidth}px`,g.style.height=`${k}px`,h.scale(c.pixelRatio,c.pixelRatio),h.fillStyle=f.background,h.fillRect(0,0,c.canvasWidth,k),w&&((t,e,o,a,n,i)=>{const r=t.createLinearGradient(0,0,o,a);n.headerGradient.forEach(((t,e)=>{r.addColorStop(e/(n.headerGradient.length-1||1),t)})),t.fillStyle=r,t.fillRect(0,0,o,a),t.fillStyle=n.titleText,t.font=`bold ${i.fontSizes.title}px ${i.fontFamily}`,t.textAlign="center",t.textBaseline="middle",t.fillText(e,o/2,a/1.8)})(h,i,c.canvasWidth,c.headerHeight,f,c);const B=t.map((t=>t.country.key)),R={};await Promise.all(B.map((async t=>{try{R[t]=await(async t=>{try{const o=[`https://flagcdn.com/w320/${t.toLowerCase()}.png`,`https://flagsapi.com/${t.toUpperCase()}/flat/64.png`];for(const t of o)try{if(t.endsWith(".svg"))return await a(t,100,75);{const e=new Image;return await new Promise(((o,a)=>{e.onload=()=>o(),e.onerror=e=>a(new Error(`Image load error from ${t}: ${e}`)),e.crossOrigin="anonymous",e.src=t})),e}}catch(e){}throw new Error(`Could not load flag for ${t} from any source`)}catch(e){return null}})(t)}catch(e){R[t]=null}})));const $=b+c.padding;let v=Array(2).fill($);const F=Array(2).fill(0).map(((t,e)=>c.padding+e*(m+c.columnPadding)));for(let e=0;e<t.length;e++){const o=t[e],a=e+1,n=x[e],i=R[o.country.key],r=Math.floor(e/u);s(h,o,i,a,F[r],v[r],m,n,f,c),v[r]+=n+c.itemMargin}const T=k-30-c.footerMargin;return((t,e,o,a,n,i,r)=>{t.fillStyle=i.background,t.fillRect(0,n,o,a),t.fillStyle=i.footerText,t.font=`italic ${.9*r.fontSizes.song}px ${r.fontFamily}`,t.textAlign="center",t.textBaseline="middle",t.fillText(e,o/2,n+a/2)})(h,"Generated with eurovision-ranker.com",c.canvasWidth,30,T,f,c),g},c=async(o,a="",n={},i={})=>{if(0===o.length)return void t.error("Please rank some countries first");const r={...e,...n};(!r.pixelRatio||r.pixelRatio<2)&&(r.pixelRatio=2);const l=t.loading("Creating your ranking image...");try{const e=await d(o,a,r,i),n=`${(a&&""!==a.trim()?a.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""):"eurovision-ranking")||"ranking"}.png`,s=await new Promise((t=>{e.toBlob((e=>{t(e)}),"image/png",1)}));if(!s)throw new Error("Failed to create image blob.");const c=URL.createObjectURL(s),f=document.createElement("a");f.href=c,f.download=n,document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(c),t.dismiss(l),t.success("Ranking image downloaded!")}catch(s){t.dismiss(l),t.error(`Failed to create image: ${s instanceof Error?s.message:String(s)}`)}};export{d as createRankingCanvas,c as downloadRankingImage};
