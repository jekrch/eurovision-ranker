import{n as t}from"./App-ksKnegs5.js";import"./index-Bpx4Vlgm.js";import"./react-D41Hy763.js";import"./redux-BaDTb7KV.js";const e=(t,e)=>{if("undefined"==typeof window||!document.documentElement)return e;return getComputedStyle(document.documentElement).getPropertyValue(t).trim()||e},o={baseItemHeight:70,itemMargin:12,canvasWidth:800,padding:20,columnPadding:20,headerHeight:60,footerMargin:10,itemPadding:8,rankBoxWidth:55,rankBoxColor:e("--er-surface-accent","#334678"),flagBoxWidth:60,flagBoxHeight:45,flagBoxColor:e("--er-surface-tertiary","#1c214c"),textBoxColor:"transparent",boxGap:15,textPaddingLeft:20,cardCornerRadius:8,boxCornerRadius:4,fontFamily:"Arial, sans-serif",pixelRatio:2,fontSizes:{title:26,rankNumber:25,artist:15,song:13}},a=(t,e,o)=>new Promise(((a,n)=>{fetch(t,{mode:"cors",headers:{Origin:window.location.origin}}).then((e=>{if(!e.ok)throw new Error(`Failed to load SVG: ${e.status} ${e.statusText} from ${t}`);return e.text()})).then((r=>{const i=new Blob([r],{type:"image/svg+xml"}),l=URL.createObjectURL(i),d=new Image(e,o);d.onload=()=>{URL.revokeObjectURL(l),a(d)},d.onerror=e=>{URL.revokeObjectURL(l),n(new Error(`Failed to load SVG image from data URL (original: ${t}): ${e}`))},d.src=l})).catch((t=>n(t)))})),n=(t,e="normal")=>new Promise((o=>{const a=`${e} 16px ${t}`;document.fonts&&"function"==typeof document.fonts.check?document.fonts.ready.then((()=>{if(document.fonts.check(a))return void o(!0);new FontFace(t,`local('${t}')`,{weight:e}).load().then((t=>{document.fonts.add(t),o(!0)})).catch((()=>{o(!1)}))})).catch((()=>{o(!1)})):o(!0)})),r=(t,e,o,a,n,r=4,i=!0,l=!1)=>{a<2*r&&(r=a/2),n<2*r&&(r=n/2),t.beginPath(),t.moveTo(e+r,o),t.arcTo(e+a,o,e+a,o+n,r),t.arcTo(e+a,o+n,e,o+n,r),t.arcTo(e,o+n,e,o,r),t.arcTo(e,o,e+a,o,r),t.closePath(),i&&t.fill(),l&&t.stroke()},i=(t,e,o,a,n,i,l,d)=>{t.fillStyle=d,r(t,o,a,n,i,l.boxCornerRadius),t.fillStyle=(t=>{const e={al:"#dc3545",am:"#dc3545",au:"#28a745",at:"#dc3545",az:"#17a2b8",be:"#000000",hr:"#dc3545",cy:"#ffc107",cz:"#fd7e14",dk:"#343a40",ee:"#6f42c1",fi:"#28a745",fr:"#0d6efd",ge:"#dc3545",de:"#6c757d",gr:"#28a745",is:"#fd7e14",ie:"#28a745",il:"#28a745",it:"#28a745",lv:"#6f42c1",lt:"#ffc107",lu:"#dc3545",mt:"#28a745",me:"#6c757d",nl:"#fd7e14",no:"#dc3545",pl:"#6c757d",pt:"#28a745",sm:"#28a745",rs:"#dc3545",si:"#28a745",es:"#6f42c1",se:"#28a745",ch:"#6f42c1",ua:"#28a745",gb:"#28a745",uk:"#28a745"};if(e[t.toLowerCase()])return e[t.toLowerCase()];let o=0;for(let n=0;n<t.length;n++)o=t.charCodeAt(n)+((o<<5)-o);let a="#";for(let n=0;n<3;n++){const t=o>>8*n&255;a+=("00"+Math.min(Math.max(t,60),200).toString(16)).slice(-2)}return a})(e);t.fillRect(o+2,a+2,n-4,i-4),t.fillStyle="#ffffff",t.font=`bold ${Math.min(16,i-8)}px ${l.fontFamily}`,t.textAlign="center",t.textBaseline="middle",t.fillText(e.toUpperCase(),o+n/2,a+i/2)},l=(t,e,o,a)=>{if(o<=0)return[e];const n=e.split(" "),r=[];let i=n[0]||"";t.font=a;for(let l=1;l<n.length;l++){const e=n[l],a=i+" "+e,{width:d}=t.measureText(a);d<o&&i?i=a:(i&&r.push(i),i=e)}return i&&r.push(i),r.filter((t=>""!==t.trim()))},d=(t,o,a,n,d,s,c,f,g,m)=>{const{country:h,contestant:x}=o,u=e("--er-interactive-primary","#9e33ea"),p=e("--er-gradient-text-2","#6a91d1"),y=e("--er-gradient-text-3","#3b82f6");t.save(),t.shadowColor=g.shadow,t.shadowBlur=5,t.shadowOffsetX=2,t.shadowOffsetY=2,t.fillStyle=g.cardBackground,r(t,d,s,c,f,m.cardCornerRadius,!0,!1),t.restore();const w=d+m.itemPadding,b=s+m.itemPadding,k=f-2*m.itemPadding;let C=g.rankBoxColor;1===n?C=u:2===n?C=p:3===n&&(C=y),t.fillStyle=C,r(t,w,b,m.rankBoxWidth,k,m.boxCornerRadius),t.fillStyle=g.rankText,t.font=`bold ${m.fontSizes.rankNumber}px ${m.fontFamily}`,t.textAlign="center",t.textBaseline="middle",t.fillText(n.toString(),w+m.rankBoxWidth/2,b+k/2);const S=w+m.rankBoxWidth+m.boxGap,B=s+(f-m.flagBoxHeight)/2;a?((t,e,o,a,n,l,d,s,c)=>{t.save(),t.fillStyle=c,r(t,a,n,l,d,s.boxCornerRadius,!0,!1),t.beginPath(),t.moveTo(a+s.boxCornerRadius-2,n),t.arcTo(a+l,n,a+l,n+d,s.boxCornerRadius),t.arcTo(a+l,n+d,a,n+d,s.boxCornerRadius),t.arcTo(a,n+d,a,n,s.boxCornerRadius),t.arcTo(a,n,a+l,n,s.boxCornerRadius),t.closePath(),t.clip();const f=e.naturalWidth||e.width,g=e.naturalHeight||e.height;if(!f||!g)return t.restore(),void i(t,o,a,n,l,d,s,c);const m=f/g,h=l/d;let x=0,u=0,p=f,y=g;m>h?(p=g*h,x=(f-p)/2):m<h&&(y=f/h,u=(g-y)/2);try{t.drawImage(e,x,u,p,y,a,n,l,d)}catch(w){}t.restore()})(t,a,h.key,S,B,m.flagBoxWidth,m.flagBoxHeight,m,g.flagBoxColor):i(t,h.key,S,B,m.flagBoxWidth,m.flagBoxHeight,m,g.flagBoxColor);const R=S+m.flagBoxWidth+m.textPaddingLeft,v=s+m.itemPadding,$=c-(R-d)-m.itemPadding,T=f-2*m.itemPadding;"transparent"!==m.textBoxColor&&(t.fillStyle=m.textBoxColor,r(t,R,v,$,T,m.boxCornerRadius));const P=(null==x?void 0:x.artist)||"Unknown Artist",F=(null==x?void 0:x.song)?`"${x.song}"`:"",z=`bold ${m.fontSizes.artist}px ${m.fontFamily}`,L=`${m.fontSizes.song}px ${m.fontFamily}`,M=1.25,W=l(t,P,$,z);let E=W.length*m.fontSizes.artist*M,U=[];F&&(U=l(t,F,$,L),E+=5+U.length*m.fontSizes.song*M);let A=v+(T-E)/2;A=Math.max(A,v),t.textAlign="left",t.textBaseline="top",t.fillStyle=g.artistText,t.font=z,W.forEach((e=>{t.fillText(e,R,A),A+=m.fontSizes.artist*M})),F&&(A+=5,t.fillStyle=g.songText,t.font=L,U.forEach((e=>{t.fillText(e,R,A),A+=m.fontSizes.song*M})))},s=async(t,r="My Eurovision Ranking",i={},s={})=>{const c={background:e("--er-body-bg","#0d0f1d"),headerGradient:[e("--er-nav-gradient-start","#13172b"),e("--er-nav-gradient-end","#334678")],cardBackground:e("--er-surface-tertiary","#03022d"),titleText:e("--er-text-primary","#e2e8f0"),rankText:"#FFFFFF",artistText:e("--er-text-primary","#e2e8f0"),songText:e("--er-text-secondary","#cbd5e1"),footerText:e("--er-text-tertiary","#a7b9d2"),shadow:"rgba(0, 0, 0, 0.3)",rankBoxColor:e("--er-nav-gradient-end","#334678"),flagBoxColor:e("--er-surface-accent","#1c214c")},f={...{...o,rankBoxColor:e("--er-surface-accent","#334678"),flagBoxColor:e("--er-surface-tertiary","#1c214c")},...i};f.fontSizes={...o.fontSizes,...i.fontSizes};const g={...c,...s},m=document.createElement("canvas"),h=m.getContext("2d");if(!h)throw new Error("Canvas 2D context not supported");await n(f.fontFamily,"normal"),await n(f.fontFamily,"bold");const x=(f.canvasWidth-2*f.padding-1*f.columnPadding)/2,u=t.map((t=>((t,e,o,a)=>{var n,r;const i=(null==(n=e.contestant)?void 0:n.artist)||"Unknown Artist",d=(null==(r=e.contestant)?void 0:r.song)?`"${e.contestant.song}"`:"",s=o-(a.itemPadding+a.rankBoxWidth+a.boxGap+a.flagBoxWidth+a.textPaddingLeft)-a.itemPadding;let c=0;const f=`bold ${a.fontSizes.artist}px ${a.fontFamily}`;if(c+=l(t,i,s,f).length*a.fontSizes.artist*1.25,d){c+=5;const e=`${a.fontSizes.song}px ${a.fontFamily}`;c+=l(t,d,s,e).length*a.fontSizes.song*1.25}const g=Math.max(a.flagBoxHeight,c);return Math.max(a.baseItemHeight,g+2*a.itemPadding)})(h,t,x,f))),p=Math.ceil(t.length/2);let y=Array(2).fill(0);for(let e=0;e<t.length;e++){const t=Math.floor(e/p);t<2?y[t]+=u[e]+f.itemMargin:y[1]+=u[e]+f.itemMargin}y=y.map((t=>t>0?t-f.itemMargin:0));const w=Math.max(0,...y),b=r&&""!==r.trim(),k=b?f.headerHeight:0,C=k+f.padding+w+f.padding+f.footerMargin+30,S=f.canvasWidth*f.pixelRatio,B=C*f.pixelRatio;m.width=S,m.height=B,m.style.width=`${f.canvasWidth}px`,m.style.height=`${C}px`,h.scale(f.pixelRatio,f.pixelRatio),h.fillStyle=g.background,h.fillRect(0,0,f.canvasWidth,C),b&&((t,e,o,a,n,r)=>{const i=t.createLinearGradient(0,0,o,a);n.headerGradient.forEach(((t,e)=>{i.addColorStop(e/(n.headerGradient.length-1||1),t)})),t.fillStyle=i,t.fillRect(0,0,o,a),t.fillStyle=n.titleText,t.font=`bold ${r.fontSizes.title}px ${r.fontFamily}`,t.textAlign="center",t.textBaseline="middle",t.fillText(e,o/2,a/1.8)})(h,r,f.canvasWidth,f.headerHeight,g,f);const R=t.map((t=>t.country.key)),v={};await Promise.all(R.map((async t=>{try{v[t]=await(async t=>{try{const o=[`https://flagcdn.com/w320/${t.toLowerCase()}.png`,`https://flagsapi.com/${t.toUpperCase()}/flat/64.png`];for(const t of o)try{if(t.endsWith(".svg"))return await a(t,100,75);{const e=new Image;return await new Promise(((o,a)=>{e.onload=()=>o(),e.onerror=e=>a(new Error(`Image load error from ${t}: ${e}`)),e.crossOrigin="anonymous",e.src=t})),e}}catch(e){}throw new Error(`Could not load flag for ${t} from any source`)}catch(e){return null}})(t)}catch(e){v[t]=null}})));const $=k+f.padding;let T=Array(2).fill($);const P=Array(2).fill(0).map(((t,e)=>f.padding+e*(x+f.columnPadding)));for(let e=0;e<t.length;e++){const o=t[e],a=e+1,n=u[e],r=v[o.country.key],i=Math.floor(e/p);d(h,o,r,a,P[i],T[i],x,n,g,f),T[i]+=n+f.itemMargin}const F=C-30-f.footerMargin;return((t,e,o,a,n,r,i)=>{t.fillStyle=r.background,t.fillRect(0,n,o,a),t.fillStyle=r.footerText,t.font=`italic ${.9*i.fontSizes.song}px ${i.fontFamily}`,t.textAlign="center",t.textBaseline="middle",t.fillText(e,o/2,n+a/2)})(h,"Generated with eurovision-ranker.com",f.canvasWidth,30,F,g,f),m},c=async(e,a="",n={},r={})=>{if(0===e.length)return void t.error("Please rank some countries first");const i={...o,...n};(!i.pixelRatio||i.pixelRatio<2)&&(i.pixelRatio=2);const l=t.loading("Creating your ranking image...");try{const o=await s(e,a,i,r),n=`${(a&&""!==a.trim()?a.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""):"eurovision-ranking")||"ranking"}.png`,d=await new Promise((t=>{o.toBlob((e=>{t(e)}),"image/png",1)}));if(!d)throw new Error("Failed to create image blob.");const c=URL.createObjectURL(d),f=document.createElement("a");f.href=c,f.download=n,document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(c),t.dismiss(l),t.success("Ranking image downloaded!")}catch(d){t.dismiss(l),t.error(`Failed to create image: ${d instanceof Error?d.message:String(d)}`)}};export{s as createRankingCanvas,c as downloadRankingImage};
