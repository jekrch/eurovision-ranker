import{j as e,u as a,L as s,M as t,y as l,f as n,N as r,O as o,Q as i,R as c,S as m,T as d,v as h,U as x,V as p,W as u,X as v,Y as b,i as g,Z as j,$ as y,a0 as f,a1 as N,a2 as w,a3 as k,z as C}from"./index-BHKPkAhI.js";import{r as S,R as $}from"./redux-BaDTb7KV.js";import{u as A,I as T,s as M,U as E,c as z,j as F,V as D,W as O,T as R,X as W,Y as I,Z as U,$ as V,p as B,q as L,a0 as J,o as X,a1 as Y}from"./App-B8TLBaHb.js";import{M as Z}from"./Modal-HzcM_iBs.js";import{D as q}from"./Dropdown-Bkx1SPr3.js";import{E as K,c as Q,a as _,g as G,b as H,d as P}from"./ExportUtil-CNVAoaF2.js";import{T as ee}from"./TabButton-DdGYlqch.js";import"./react-D41Hy763.js";const ae=()=>{const[a,s]=S.useState("Text"),t=Object.values(K).map((e=>e)),l=A((e=>e.rankedItems));return e.jsxs("div",{className:"mb-0",children:[e.jsx("div",{className:"mb-[1.5em]",children:e.jsx(T,{className:"pl-[0.7em] ml-0 py-[0.5em] px-[1em]",onClick:Q,icon:M,title:"Copy URL to Clipboard"})}),e.jsx(q,{className:"z-50 w-20 h-10 mx-auto",menuClassName:"",value:a,onChange:e=>s(e),options:t,showSearch:!1},"type-selector"),e.jsxs("div",{children:[e.jsx(T,{className:"ml-0 pl-[0.7em] rounded-md text-xs py-[0.5em] pr-[1em]",onClick:async function(){let e=await G(a,l),s=H(a);P(e,null==s?void 0:s.fileExtension)},icon:E,title:"Download"}),e.jsx(T,{className:"ml-4 pl-[0.7em] py-[0.5em] pr-[1em]",onClick:()=>_(l,a),icon:M,title:"Copy to Clipboard"})]})]})},se=({checked:a,onChange:s,label:t,className:l,id:n})=>e.jsxs("div",{className:z("inline-flex items-center",l),children:[e.jsxs("label",{className:"relative flex items-center p-3 rounded-full cursor-pointer",htmlFor:"blue",children:[e.jsx("input",{type:"checkbox",className:"before:content[''] peer relative h-5 w-5 cursor-pointer appearance-none rounded-md border border-blue-gray-200 transition-all before:absolute before:top-2/4 before:left-2/4 before:block before:h-12 before:w-12 before:-translate-y-2/4 before:-translate-x-2/4 before:rounded-full before:bg-blue-gray-500 before:opacity-0 before:transition-opacity checked:border-blue-500 checked:bg-blue-500 checked:before:bg-blue-500 hover:before:opacity-10",id:n,checked:a??!1,onChange:e=>s(e.target.checked)},`key-${n}`),e.jsx("span",{className:"absolute text-white transition-opacity opacity-0 pointer-events-none top-2/4 left-2/4 -translate-y-2/4 -translate-x-2/4 peer-checked:opacity-100",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",viewBox:"0 0 20 20",fill:"currentColor",stroke:"currentColor",strokeWidth:"1",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]}),e.jsx("span",{className:"text-slate-400 text-sm",children:t})]}),te=()=>{const t=F(),l=A((e=>e.categories)),n=A((e=>e.activeCategory)),[r,o]=S.useState(""),i=A((e=>e.showComparison)),c=()=>{if(""!==r.trim()){if(!I(r,l))return;const e=[...l,{name:r,weight:5}];o(""),D(e,t,l,n)}};return e.jsxs("div",{className:"mb-0",children:[e.jsxs("p",{className:"relative mb-[1em] mt-2 text-sm",children:["Create categories to build multiple rankings based on different criteria: e.g. ",e.jsx("i",{children:"Vocals, Dance, Lyrics"})," ","etc."]}),e.jsxs("div",{className:"mt-5 mb-[1.5em]",children:[e.jsx("span",{className:"font-bold ml-0 whitespace-nowrap",children:"Categories"}),e.jsxs("div",{className:"mt-4",children:[e.jsx("input",{type:"text",placeholder:"Enter category name",value:r,onChange:e=>o(e.target.value),onKeyDown:e=>{"Enter"===e.key&&c()},className:"px-2.5 py-1.5 ml-1 mr-3 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white"}),e.jsx(T,{className:"ml-1 pl-[0.7em] py-[0.5em] pr-[1em]",onClick:c,icon:void 0,title:"Add"}),(null==l?void 0:l.length)>0&&e.jsx(T,{className:"ml-3 mt-2 bg-rose-800 hover:bg-rose-700 text-white font-normal pl-[0.7em] py-[0.5em] pr-[1em]",onClick:()=>{D([],t,l,n)},disabled:!(null==l?void 0:l.length),icon:O,title:"Clear"})]}),e.jsxs("div",{className:"mt-1",children:[e.jsx(R,{content:"When viewing a category ranking, also display the contestant's rank in each other category",className:"ml-2 pb-1"}),e.jsx(se,{id:"total-checkbox",checked:i,onChange:e=>{return a({cm:!0===(l=e)?"t":"f"}),void t(s(!0===l));var l},label:"Show Category Comparisons"})]}),e.jsxs("table",{className:"mt-4 w-full table-auto",children:[(null==l?void 0:l.length)>0&&e.jsx("thead",{children:e.jsxs("tr",{className:"text-sm",children:[e.jsx("th",{className:"text-left px-2",children:"Name"}),e.jsx("th",{className:"text-left px-2",children:"Weight"}),e.jsx("th",{className:"px-2"})]})}),e.jsx("tbody",{children:l.map(((a,s)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 py-2",children:e.jsx("input",{type:"text",value:a.name,onChange:e=>((e,a)=>{if(!I(a,l))return;let s=[...l];s[e]={...l[e],name:a},D(s,t,l,n)})(s,e.target.value),className:"px-2.5 py-1.5 mr-3 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white w-full"})}),e.jsx("td",{className:"px-2",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"range",min:"0",max:"10",step:"1",value:a.weight,onChange:e=>((e,a)=>{let s=[...l];s[e]={...s[e],weight:a},D(s,t,l,n)})(s,parseInt(e.target.value)),className:"w-full"}),e.jsx("span",{className:"ml-2 w-3",children:a.weight})]})}),e.jsx("td",{className:"px-2",children:e.jsx("button",{onClick:()=>W(s,t,l,n),className:"bg-rose-700 hover:bg-rose-600 text-white rounded-md px-2 py-[0.1em]",children:"X"})})]},s)))})]})]})]})},le=()=>{const a=A((e=>e.year)),s=A((e=>e.theme)),[h,x]=S.useState(a),[p,u]=S.useState("All"),[v,b]=S.useState(["All",...t.sort(((e,a)=>e.name.localeCompare(a.name))).map((e=>e.name))]),[g,j]=S.useState(!1),[y,f]=S.useState(!1);S.useEffect((()=>{(async()=>{const e=await n(h,void 0);b(["All",...e.map((e=>e.country)).sort(((e,a)=>e.name.localeCompare(a.name))).map((e=>e.name))]),f(r(e)),j(o(e))})()}),[h]);const N=async(e,s,l,r)=>{var o;let i,c;(null==r?void 0:r.length)&&"All"!==r&&(c=null==(o=t.find((e=>e.name===r)))?void 0:o.key,c&&(i=`${l}-${s}-${c}`));let h=await n(e,i);if("1956"===m(a))return h.filter((e=>{var a;return"1"===(null==(a=e.contestant)?void 0:a.finalsRank.toString())})).map((e=>e.id)).join("");h=await d(h,s,l,c);return h.filter((e=>{var a;return void 0!==(null==(a=null==e?void 0:e.contestant)?void 0:a.votes)})).map((e=>e.id)).join("")},w=async e=>{const s=h??a;return`?r=${await N(s,"televote","final",e)}&y=${s.substring(2,4)}&n=Final+Televote${C(e)}&v=${c("f","tv",e)}`},k=async e=>{const s=h??a;return`?r=${await N(s,"jury","final",e)}&y=${s.substring(2,4)}&n=Final+Jury${C(e)}&v=${c("f","j",e)}`},C=e=>(null==e?void 0:e.length)&&"All"!==e?`+from+${e.replaceAll(" ","+")}`:"";return e.jsxs("div",{className:"mb-0",children:[e.jsx("p",{className:"relative mb-[1em] mt-2 text-sm",children:"Select a year and voting country, then click one of the buttons to see official final rankings"}),e.jsxs("div",{className:"mt-5",children:[e.jsx("span",{className:"font-bold ml-0 whitespace-nowrap",children:"ESC final rankings"}),e.jsxs("div",{className:" mt-[0.7em]",children:[e.jsxs("div",{children:[e.jsx(q,{className:"w-20 mx-auto mb-2",menuClassName:"",value:h??a,onChange:e=>x(e),options:l.filter((e=>"2020"!==e&&"2025"!==e)),showSearch:!0}),e.jsx("span",{className:"ml-2 text-sm",children:"from"}),e.jsx(R,{content:"Choose which country to display voting counts from. 'All' will show the total vote count",className:"ml-4 z-50"}),e.jsx(q,{className:"ml-3 mx-auto mb-2",menuClassName:"w-auto",value:p,onChange:e=>u(e),options:v,showSearch:!0},"country-selector")]}),e.jsx("div",{className:"mt-2 ml-0",children:e.jsxs("span",{className:"",children:[e.jsx(T,{onClick:async()=>{const e=h??a,t=await N(e,"total","final",p);i(`?r=${t}&y=${e.substring(2,4)}&n=Final${C(p)}&v=${c("f","t",p)}`,s)},className:"pl-[1em] pr-[1em] rounded-md",title:"total"}),y&&e.jsx(T,{onClick:async()=>{const e=await w(p);i(e,s)},className:"ml-3 pl-[1em] pr-[1em] rounded-md",title:"televote"}),g&&e.jsx(T,{onClick:async()=>{const e=await k(p);i(e,s)},className:"ml-3 pl-[1em] pr-[1em] rounded-md",title:"jury"})]})})]})]})]})},ne=()=>{const l=F(),n=A((e=>e.vote)),r=A((e=>e.theme)),o=A((e=>e.showComparison)),i=A((e=>e.showThumbnail)),c=A((e=>e.rankedItems)),m=A((e=>e.year)),d=A((e=>e.globalSearch)),[f,N]=S.useState("None"),w=e=>{var a,s;if(!(null==e?void 0:e.length)||"loading"===e)return"All";const l=e.split("-")[2];return l?null==(s=null==(a=t.filter((e=>e.key===l)))?void 0:a[0])?void 0:s.name:"All"},[k,C]=S.useState((()=>w(n))),[$,T]=S.useState(["All",...t.sort(((e,a)=>e.name.localeCompare(a.name))).map((e=>e.name))]);S.useEffect((()=>{N("ab"===r?"Auroral":"None")}),[r]),S.useEffect((()=>{const e=w(n);e!==k&&C(e)}),[n]);const M=(e,s)=>{const t=p(n,e,s);t!==n&&(l(u(t)),a({v:t}))};return S.useEffect((()=>{(async()=>{var e;if("loading"===n)return;let s=(null==(e=null==n?void 0:n.split("-"))?void 0:e[1])??"",r=(e=>{var a,s;return(null==e?void 0:e.length)&&"All"!==e?null==(s=null==(a=t.filter((a=>a.name===e)))?void 0:a[0])?void 0:s.key:""})(k),o=`f-${s}-${r}`;await async function(e,a){if(d){let s=await b(e,a);l(g(s))}else{let e=await j(a,m);l(y(e))}}(c,o),o!==n&&(a({v:o}),l(u(o)))})()}),[k]),e.jsxs("div",{className:"mb-0",children:[e.jsx("div",{children:e.jsxs("div",{className:"mb-[0.5em] border-slate-700 border-b-[1px] pb-2 -mt-2",children:[e.jsxs("span",{className:"flex items-center ml-2",children:[e.jsx(R,{content:"Select which types of votes to display with each ranked country"}),e.jsx("span",{className:"ml-3 text-sm font-semibold",children:"Show Votes:"}),e.jsx(se,{id:"total-checkbox",checked:h(n,"t"),onChange:e=>M("t",e),label:"Total"}),e.jsx(se,{id:"tele-checkbox",checked:h(n,"tv"),onChange:e=>M("tv",e),label:"Tele",className:"ml-[0.5em]"}),e.jsx(se,{id:"jury-checkbox",checked:h(n,"j"),onChange:e=>M("j",e),label:"Jury",className:"ml-[0.5em]"})]}),e.jsxs("div",{className:"mt-[0.5em]",children:[e.jsx(R,{content:"Choose which country to display voting counts from. 'All' will show the total vote count",className:"ml-4"}),e.jsx("span",{className:"ml-3 text-sm font-semibold",children:"From:"}),e.jsx(q,{className:"ml-5 min-w[6em] mx-auto mb-2",menuClassName:"w-auto",value:k,onChange:e=>C(e),options:$,showSearch:!0},"country-selector-2")]})]})}),e.jsx("div",{children:e.jsx("div",{className:"mt-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:"mb-0",children:[e.jsx(R,{content:"Determine whether to show a thumbnail of the song video",className:"ml-4 pb-1"}),e.jsx(se,{id:"thumbnail-checkbox",checked:i,onChange:e=>{return a({p:!0===(s=e)?"t":"f"}),void l(v(!0===s));var s},label:"Show Video Thumbnails"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx(R,{content:"When viewing a category ranking, also display the contestant's rank in each other category",className:"ml-4 pb-1"}),e.jsx(se,{id:"total-checkbox",checked:o,onChange:e=>{return a({cm:!0===(t=e)?"t":"f"}),void l(s(!0===t));var t},label:"Show Category Comparisons"})]}),e.jsx("span",{className:"ml-5 font-semibold text-sm mb-[0.7em]",children:"Theme:"}),e.jsx(q,{className:"ml-5 w-30 mx-auto mb-3",menuClassName:"",value:f,onChange:e=>{"Auroral"===e?(l(x("ab")),a({t:"ab"})):(l(x("")),a({t:""}))},options:["None","Auroral"],showSearch:!1},"theme-selector")]})})})]})},re=a=>e.jsx("span",{className:z("px-2 py-0.5 bg-blue-500 text-white text-xs font-semibold rounded-full",a.className),children:"Beta"}),oe=()=>{var l;const r=F(),o=A((e=>e.year)),i=A((e=>e.categories)),c=A((e=>e.activeCategory)),[m,h]=S.useState((null==(l=f(o))?void 0:l.length)>1?"Televote":"Total"),[x,p]=S.useState([]),[u,v]=S.useState([]),[b,g]=S.useState(new Map),j=A((e=>e.showComparison)),y=A((e=>e.globalSearch)),M=async(e,a,s)=>{var l;const r=new Map,o=await n(s,"");for(const n of t){const a=await E(e,m,"final",o,n.key);r.has(a)?null==(l=r.get(a))||l.push(n):r.set(a,[n])}return r},E=async(e,a,s,t,l)=>(t=await d(t,a,s,l)).filter((e=>{var a;return void 0!==(null==(a=null==e?void 0:e.contestant)?void 0:a.votes)})).map((a=>e?a.uid:null==a?void 0:a.id)).join("");const z=(e,a)=>`${e.charAt(0).toUpperCase()+e.slice(1)}: ${a}`,O=(e,a)=>`?r=${e.list2Code}&y=${o.substring(2,4)}&n=${z(m,a).replaceAll(" ","+")}&v=f-${w(m)}-${k(a)}`,W=e=>{const a=Math.round(10*e)/10;return a%1==0?a.toFixed(0):a.toFixed(1)},I=(s,t)=>e.jsxs("div",{className:"mt-4",children:[e.jsxs("p",{className:"text-sm mb-2",children:[t," ",m," rankings:"]}),e.jsx("div",{className:"grid grid-cols-[auto,1fr] gap-x-4 gap-y-2",children:s.flatMap((s=>{return(t=[s],l=b,t.flatMap((e=>l.get(e.list2Code)??[])).map((e=>e.name)).sort(((e,a)=>null==e?void 0:e.localeCompare(a)))).map(((t,l)=>e.jsxs($.Fragment,{children:[e.jsx("div",{className:"whitespace-nowrap flex items-center",children:e.jsx("a",{href:O(s,t),target:"_blank",rel:"noopener noreferrer",className:" text-blue-500 hover:underline",title:z(m,t),children:e.jsxs("span",{className:"mt-auto",children:[t," (",W(s.percentSimilarity),"%)"]})})}),e.jsx("div",{children:e.jsx(T,{className:"pl-[0.7em] py-[0.5em] pr-[1em]",onClick:()=>((e,s)=>{const t=C("r");let l=[...i];if(t){const e={name:"Original",weight:5};l=[...l,e]}const n={name:s,weight:0},o=[...l,n];D(o,r,l,c),a({[`r${o.length}`]:e})})(s.list2Code,z(m,t)),icon:void 0,title:"Add as Category"})})]},`${s.list2Code}-${l}`)));var t,l}))})]});return e.jsxs("div",{className:"mb-0",children:[e.jsxs("div",{className:"relative mb-[1em] mt-2 flex items-center",children:[e.jsx("div",{className:"flex justify-center items-center mr-3 ml-3",children:e.jsx(re,{className:"flex-shrink-0"})}),e.jsx("p",{className:"text-sm mr-1",children:"Compare your current ranking with the Jury or Tele vote from each participating country"})]}),e.jsxs("div",{className:"mt-5 mb-[1.5em]",children:[e.jsx("div",{children:e.jsx(q,{className:"z-50 ml-3 mx-auto mb-2",menuClassName:"w-auto",value:m,onChange:e=>{h(e),p([]),v([])},options:f(o),showSearch:!1},"vote-type-selector")}),e.jsxs("div",{className:"mb-1",children:[e.jsx(R,{content:"When viewing a category ranking, also display the contestant's rank in each other category",className:"ml-2 pb-1"}),e.jsx(se,{id:"total-checkbox",checked:j,onChange:e=>{return a({cm:!0===(t=e)?"t":"f"}),void r(s(!0===t));var t},label:"Show Category Comparisons"})]}),e.jsx(T,{className:"ml-3 pl-[0.7em] py-[0.5em] pr-[1em]",onClick:async()=>await(async()=>{const e=N(c).rankings,a=await M(y,0,o);g(a);const s=Array.from(a.keys()),t=await U(o,e,s);p(t)})(),icon:void 0,title:"Most similar"}),e.jsx(T,{className:"ml-3 font-normal pl-[0.7em] rounded-md text-xs py-[0.5em] pr-[1em]",onClick:async()=>await(async()=>{const e=N(c).rankings,a=await M(y,0,o);g(a);const s=Array.from(a.keys()),t=await V(o,e,s);v(t)})(),icon:void 0,title:"Most dissimilar"})]}),x.length>0&&I(x,"Most similar"),u.length>0&&I(u,"Most dissimilar")]})},ie=a=>{const[s,t]=S.useState(a.tab),l=A((e=>e.globalSearch)),n=A((e=>e.rankedItems));return new Set(n.map((e=>{var a;return null==(a=e.contestant)?void 0:a.year})).filter(Boolean)).size,S.useEffect((()=>{a.isOpen&&t(a.tab)}),[a.tab,a.isOpen]),e.jsxs(Z,{isOpen:a.isOpen,onClose:a.onClose,className:"",children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 -mt-4",children:e.jsxs("ul",{className:"flex flex-wrap -mb-px text-sm font-medium text-center text-gray-500 dark:text-gray-400",children:[e.jsx(ee,{isActive:"rankings"===s,onClick:()=>t("rankings"),icon:B,label:"Rankings"}),e.jsx(ee,{isActive:"display"===s,onClick:()=>t("display"),icon:L,label:"Display"}),e.jsx(ee,{isActive:"export"===s,onClick:()=>t("export"),icon:J,label:"Export"}),e.jsx(ee,{isActive:"categories"===s,onClick:()=>t("categories"),icon:X,label:"Categories"}),!l&&e.jsx(ee,{isActive:"analyze"===s,onClick:()=>t("analyze"),icon:Y,label:"Analyze"})]})}),e.jsxs("div",{className:"overflow-y-auto pt-4 select-text pb-3 flex-grow",children:["display"===s&&e.jsx(ne,{}),"rankings"===s&&e.jsx(le,{}),"export"===s&&e.jsx(ae,{}),"categories"===s&&e.jsx(te,{}),"analyze"===s&&e.jsx(oe,{})]})]})};export{ie as default};
