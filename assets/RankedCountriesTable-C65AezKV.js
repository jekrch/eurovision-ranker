import{A as e,u as t,B as a,C as s,k as r,D as n,E as l,F as o,P as c,G as i,i as d,n as m,H as h,I as u,J as x,v as p,j as g,e as f,r as y,K as v,y as b,l as j}from"./index-BPRQnyE5.js";import{r as w}from"./redux-BaDTb7KV.js";import{l as N,u as C,b as S,K as k,M as P,N as z,O as _,Q as T,c as D,T as E,S as L,U as I,V as U,W as R,I as $,X as A}from"./App-BhLhPZXf.js";import{R as F}from"./index-Ba-eZ9iP.js";import{D as G}from"./Dropdown-COFJu1Bu.js";import"./react-D41Hy763.js";const M=({handleSort:e,sortColumn:t,sortDirection:a,showSelected:s})=>{const r=({column:e})=>("country"===e&&(e="to_country"),t!==e?null:"asc"===a?g.jsx(S,{icon:k,className:"ml-2"}):g.jsx(S,{icon:P,className:"ml-2"}));return g.jsx("thead",{className:"bg-[var(--er-button-neutral-hover)] text-[var(--er-text-secondary)] sticky top-0 z-40",children:g.jsxs("tr",{children:[g.jsx("th",{className:"py-3 text-center text-xs font-medium uppercase tracking-wider sticky left-0 z-50 bg-[var(--er-button-neutral-hover)]",children:s?"Del":"Add"}),["Year","Country","Performer","Song"].map((t=>g.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider cursor-pointer hover:bg-[var(--er-button-primary)]",onClick:()=>e(t.toLowerCase()),children:g.jsxs("div",{className:"flex items-center whitespace-nowrap",children:[t,g.jsx(r,{column:t.toLowerCase()})]})},t)))]})})},O=({paginatedContestants:e,handleToggleSelected:t,showSelected:a,selectedContestants:s})=>g.jsx("tbody",{className:"bg-transparent divide-y divide-gray-700",children:e.map((e=>g.jsxs("tr",{className:"hover:bg-[var(--er-surface-dark)] bg-opacity-50 text-[var(--er-text-secondary)]",children:[g.jsx("td",{className:"py-0 whitespace-nowrap sticky left-0 z-30 bg-[var(--er-surface-dark)] hover:bg-[var(--er-button-primary)]",children:g.jsx("div",{className:"flex justify-center h-full",children:g.jsx(F,{className:"flex items-center justify-center w-full h-full",placeholder:g.jsx(g.Fragment,{}),children:g.jsx("button",{onClick:()=>t(e.id),className:"text-[var(--er-text-secondary)] hover:text-slate-100 p-2 rounded-md h-full w-full",children:a?g.jsx(S,{icon:z,className:"text-[var(--r-accent-error)]"}):s.some((t=>t.id===e.id))?g.jsx(S,{icon:_,className:"text-[var(--r-accent-success)]"}):g.jsx(S,{icon:T})})})})}),g.jsx("td",{className:"px-6 py-4 whitespace-nowrap overflow-x-clip",children:e.year}),g.jsx("td",{className:"px-6 py-4 whitespace-nowrap overflow-x-clip",children:e.to_country}),g.jsx("td",{className:"px-6 py-4 whitespace-nowrap overflow-x-clip",title:e.performer,children:e.performer}),g.jsx("td",{className:"px-6 py-4 whitespace-nowrap overflow-x-clip",title:e.song,children:e.song})]},e.id)))}),H=({searchTerm:e,handleSearch:t,className:a})=>g.jsxs("div",{className:D("w-full sm:w-auto flex-grow sm:flex-grow-0 flex items-center",a),children:[g.jsx(E,{content:'Search across all columns. To search for a phrase, enclose your search term in quotes "like this"',className:"mt-2 mr-3 pb-1"}),g.jsxs("div",{className:"relative w-full mr-3",children:[g.jsx("input",{type:"text",value:e,onChange:t,placeholder:"Search...",className:"text-sm w-full pl-10 pr-4 py-[0.4em] border rounded-md focus:outline-none focus:ring-2 focus:ring-slate-400 bg-transparent text-[var(--er-text-secondary)] border-[var(--er-border-primary)]"}),g.jsx(S,{icon:L,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-[var(--er-text-tertiary)]"})]})]}),K=({pageSize:e,currentPage:t,totalPages:a,displayedContestants:s,handlePageSizeChange:r,handlePageChange:n})=>g.jsxs("div",{className:"mt-1 flex justify-between px-2",children:[g.jsxs("div",{children:[g.jsx(G,{value:`${e}`,onChange:r,options:["10","25","50"],buttonClassName:"",className:"min-w-[0.9em] text-xs mt-2",openUpwards:!0,mini:!0}),g.jsxs("span",{className:D("text-sm text-gray-300 ml-2 mr-3 whitespace-nowrap","text-xs mr-1"),children:["of ",s.length]})]}),g.jsx("div",{className:"space-x-1 space-y-2",children:g.jsxs(g.Fragment,{children:[g.jsx("button",{onClick:()=>n(1),disabled:1===t,className:"text-sm px-2 py-1 rounded bg-[var(--er-button-primary)] text-gray-300 hover:bg-[var(--er-button-primary-hover)] disabled:opacity-50 disabled:pointer-events-none",children:"<<"}),g.jsx("button",{onClick:()=>n(t-1),disabled:1===t,className:"text-sm px-2 py-1 rounded bg-[var(--er-button-primary)] text-gray-300 hover:bg-[var(--er-button-primary-hover)] disabled:opacity-50 disabled:pointer-events-none",children:"<"}),g.jsxs("span",{className:"text-sm text-gray-300",children:[t," / ",a]}),g.jsx("button",{onClick:()=>n(t+1),disabled:t===a,className:"text-sm px-2 py-1 rounded bg-[var(--er-button-primary)] text-gray-300 hover:bg-[var(--er-button-primary-hover)] disabled:opacity-50 disabled:pointer-events-none",children:">"}),g.jsx("button",{onClick:()=>n(a),disabled:t===a,className:"text-sm px-2 py-1 rounded bg-[var(--er-button-primary)] text-gray-300 hover:bg-[var(--er-button-primary-hover)] disabled:opacity-50 disabled:pointer-events-none",children:">>"})]})})]}),V=()=>{const S=N(),k=C((e=>e.showUnranked)),P=C((e=>e.rankedItems)),z=C((e=>e.tableState)),{sortColumn:_,sortDirection:T}=z,[L,F]=w.useState(!1),G=C((e=>e.activeCategory)),V=I(),{refreshUrl:W}=U(),Y=(()=>{const e=C((e=>e.rankedItems)),t=C((e=>e.globalSearch)),s=C((e=>e.categories));return w.useCallback((r=>{let n=t;void 0!==r&&(n=r),a(s,n,e)}),[t,e])})(),{paginatedContestants:q,handleSort:B,handleSearch:J,handlePageSizeChange:Q,handlePageChange:X,handleToggleSelected:Z,searchTerm:ee,showSelected:te,setShowSelected:ae,globalSearch:se,updateGlobalSearch:re,pageSize:ne,currentPage:le,totalPages:oe,displayedContestants:ce,selectedContestants:ie}=(()=>{const g=N(),f=C((e=>e.tableState)),y=C((e=>e.rankedItems)),v=C((e=>e.globalSearch)),b=C((e=>e.categories)),j=C((e=>e.activeCategory)),{sortColumn:S,sortDirection:k,pageSize:P,currentPage:z,entries:_,selectedContestants:T}=f,[D,E]=w.useState(""),[L,I]=w.useState(!1),U=w.useRef([]),R=w.useRef([]);w.useEffect((()=>{v&&(async()=>{try{let e=_;if(!(null==_?void 0:_.length)){const t=await l(),a=await t;e=F(a),g(o(e))}if(y.length>0){const t=new Set(y.map((e=>e.uid))),a=e.filter((e=>t.has(e.id)));G(a,T)||g(r(a))}A()}catch(e){}})()}),[v,_.length,y,g]);const $=w.useCallback((()=>{y.map((e=>e.uid)).join("");const a={};b.forEach(((t,s)=>{const r=`r${s+1}`,n=e(r)||"";a[r]=n})),t(a)}),[y,b]),A=w.useCallback((()=>{a(b,v,y)}),[v,y,b]),F=e=>c.parse(e,{header:!0,skipEmptyLines:!0,transformHeader:e=>e.trim(),transform:e=>e.trim()}).data.map((e=>({id:e.id,year:parseInt(e.year,10),to_country_id:e.to_country_id,to_country:e.to_country,performer:e.performer,song:e.song,place_contest:parseInt(e.place_contest,10)}))).filter((e=>e.year&&e.to_country&&e.performer&&e.song)),G=(e,t)=>{if(e.length!==t.length)return!1;for(let a=0;a<e.length;a++)if(e[a].id!==t[a].id||e[a].year!==t[a].year)return!1;return!0};w.useEffect((()=>{(async()=>{if(G(U.current,T))return;const t=e("v")??"";try{const e=y||[],a=new Set(e.map((e=>e.uid))),s=new Set(T.map((e=>e.id))),r=T.filter((e=>!a.has(e.id))).map((e=>e.id)),n=e.filter((e=>!s.has(e.uid))).map((e=>e.uid)),l=await i(r,t),o=[...e.filter((e=>!n.includes(e.uid))),...l];((e,t)=>{if(e.length!==t.length)return!1;for(let a=0;a<e.length;a++)if(e[a].uid!==t[a].uid)return!1;return!0})(o,R.current)||(g(d(o)),m(j,b,o),R.current=o),U.current=T}catch(a){}})()}),[T,j,b,y,g]),w.useEffect((()=>{g(s(1)),E("")}),[L,g]);const M=w.useMemo((()=>{const e=L?T:_,t=new Set;let a=e.filter((e=>!t.has(e.id)&&(t.add(e.id),!0)));if(D){const e=/^".*"$/.test(D.trim())?[D.trim().slice(1,-1).toLowerCase()]:D.toLowerCase().split(/\s+/);a=a.filter((t=>e.every((e=>Object.entries(t).some((([t,a])=>"id"!==t&&String(a).toLowerCase().includes(e)))))))}return S&&a.sort(((e,t)=>e[S]<t[S]?"asc"===k?-1:1:e[S]>t[S]?"asc"===k?1:-1:0)),a}),[_,T,L,D,S,k]),O=Math.ceil(M.length/P),H=M.slice((z-1)*P,z*P),K=w.useCallback(((e,a)=>{b.forEach(((s,r)=>{const n=`r${r+1}`;let l,o=new URLSearchParams(window.location.search).get(n)||"";o.startsWith(">")||(o=`>${o}`),l=a?o+e:o.replace(e,""),t({[n]:l})}))}),[b]),V=w.useCallback((e=>{let t;if(T.some((t=>t.id===e)))t=T.filter((t=>t.id!==e)),K(e,!1);else{const a=f.entries.find((t=>t.id===e));if(!a)return;t=[...T,a],K(e,!0)}g(r(t)),v&&$()}),[T,f.entries,g,K,v,$,A]);return w.useEffect((()=>{G(f.paginatedContestants,H)||g(n(H))}),[f.currentPage,f.filters,f.entries,f.sortDirection,f.sortColumn,f.pageSize]),{paginatedContestants:H,handleSort:e=>{"country"===e&&(e="to_country"),g(h(e))},handleSearch:e=>{E(e.target.value),g(u({search:e.target.value}))},handlePageSizeChange:e=>{g(x(Number(e)))},handlePageChange:e=>{g(s(e))},handleToggleSelected:V,searchTerm:D,showSelected:L,setShowSelected:I,globalSearch:v,updateGlobalSearch:e=>{t({g:e?"t":void 0}),g(p(e)),A()},pageSize:P,currentPage:z,totalPages:O,displayedContestants:M,selectedContestants:T,convertRankingURLParams:A}})(),de=()=>{re(!1),Y(!1)};return g.jsxs("div",{className:"flex flex-col h-full bg-transparent text-[var(--er-text-secondary)]",children:[g.jsxs("div",{className:D("flex flex-col mb-1 pr-1 sm:flex-row sm:items-center sm:space-x-4"),children:[g.jsx("div",{className:D("w-full xs:w-1/2"),children:g.jsx(H,{searchTerm:ee,handleSearch:J,className:"w-full mb-1"})}),g.jsxs("div",{className:D("flex items-center justify-between pb-1 text-sm mt-1 sm:mt-0 sm:justify-end sm:flex-grow min-w-[50%]"),children:[g.jsx(R,{label:"selected",className:"text-base",labelClassName:"text-[var(--er-text-tertiary)]",checked:te,setChecked:ae}),g.jsxs("div",{className:"flex items-center gap-1 mr-3",children:[g.jsxs("div",{className:"flex items-center",children:[g.jsx(E,{content:"Uncheck this to use the simple year-based selection mode",className:"text-[var(--er-text-secondary)] align-middle mb-0 -mr-1"}),g.jsx(R,{label:"adv",className:"items-center align-middle",labelClassName:"text-base text-[var(--er-text-tertiary)]",checked:se,setChecked:async e=>{if(e)re(e);else if(y(G)){const e=v(P);1===(null==e?void 0:e.length)?(S(b(e[0])),de(),W(),await j(G,S)):F(!0)}else V(),de()}})]}),g.jsx($,{className:D("tada-animation pl-[0.7em] pr-[0.9em] w-[6em]",{"tada-animation":k&&(null==P?void 0:P.length)}),onClick:()=>S(f(!k)),title:"View List"})]})]})]}),g.jsx(A,{isOpen:L,onClose:()=>F(!1),onConfirm:()=>{V(),de()},message:"Are you sure you want to turn off advanced global search mode? \n\nYour current selections will be cleared, since they contain contestants from multiple years."}),g.jsx("div",{className:"flex-grow overflow-auto !rounded-t-md !rounded-tr-md mr-1 shadow-xl",children:g.jsx("div",{className:"relative",children:g.jsxs("table",{className:"w-full bg-transparent table-fixed",children:[g.jsxs("colgroup",{children:[g.jsx("col",{className:"w-[3em]"}),g.jsx("col",{className:"w-24"}),g.jsx("col",{className:"w-40"}),g.jsx("col",{className:"w-48"}),g.jsx("col",{className:"w-64"})]}),g.jsx(M,{handleSort:B,sortColumn:_,sortDirection:T,showSelected:!1}),g.jsx(O,{paginatedContestants:q,handleToggleSelected:Z,showSelected:te,selectedContestants:ie})]})})}),g.jsx(K,{pageSize:ne,currentPage:le,totalPages:oe,displayedContestants:ce,handlePageSizeChange:Q,handlePageChange:X})]})},W=()=>{const[e,t]=w.useState(0),a=C((e=>e.rankedItems)),s=C((e=>e.categories)),r=C((e=>e.activeCategory));return w.useEffect((()=>{0!==e&&m(r,s,a)}),[e]),g.jsx("div",{className:"z-20",children:g.jsx("div",{className:D("grid h-full max-h-full min-h-full grid-rows-[auto_1fr]"),children:g.jsx("div",{className:"overflow-y-auto h-full",children:g.jsx(V,{})})})})};export{W as default};
